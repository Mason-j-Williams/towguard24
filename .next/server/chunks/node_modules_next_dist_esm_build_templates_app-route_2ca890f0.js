module.exports=[57522,e=>{"use strict";var t,n,o=e.i(47909),r=e.i(74017),i=e.i(96250),a=e.i(59756),s=e.i(61916),l=e.i(14444),u=e.i(37092),d=e.i(69741),p=e.i(16795),c=e.i(87718),m=e.i(95169),g=e.i(47587),h=e.i(66012),f=e.i(70101),y=e.i(26937),z=e.i(10372),_=e.i(93695);e.i(52474);var v=e.i(220),b=e.i(89171),w=e.i(75789),x=e.i(48804),k=e.i(7159),j=e.i(17958),I=e.i(36040);function T(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}function P(e){return Object.fromEntries([...e.headers])}var{btoa:C,atob:N}=globalThis;function S(e){let t=N(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function A(e){return e instanceof Uint8Array?function(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCodePoint(e[n]);return C(t)}(e):e}var E="AI_DownloadError",q=`vercel.ai.error.${E}`,R=Symbol.for(q),$=class extends(n=w.AISDKError,t=R,n){constructor({url:e,statusCode:n,statusText:o,cause:r,message:i=null==r?`Failed to download ${e}: ${n} ${o}`:`Failed to download ${e}: ${r}`}){super({name:E,message:i,cause:r}),this[t]=!0,this.url=e,this.statusCode=n,this.statusText=o}static isInstance(e){return w.AISDKError.hasMarker(e,q)}};async function O(e){try{let t=await fetch(e);if(!t.ok)throw new $({url:e,statusCode:t.status,statusText:t.statusText});return await t.blob()}catch(t){if($.isInstance(t))throw t;throw new $({url:e,cause:t})}}var M=(({prefix:e,size:t=16,alphabet:n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:o="-"}={})=>{let r=()=>{let e=n.length,o=Array(t);for(let r=0;r<t;r++)o[r]=n[Math.random()*e|0];return o.join("")};if(null==e)return r;if(n.includes(o))throw new w.InvalidArgumentError({argument:"separator",message:`The separator "${o}" must not be part of the alphabet "${n}".`});return()=>`${e}${o}${r()}`})();function Z(e){return(e instanceof Error||e instanceof DOMException)&&("AbortError"===e.name||"ResponseAborted"===e.name||"TimeoutError"===e.name)}var F=["fetch failed","failed to fetch"];function U(e,...t){let n=new Headers(function(e){if(null==e)return{};let t={};if(e instanceof Headers)e.forEach((e,n)=>{t[n.toLowerCase()]=e});else for(let[n,o]of(Array.isArray(e)||(e=Object.entries(e)),e))null!=o&&(t[n.toLowerCase()]=o);return t}(e)),o=n.get("user-agent")||"";return n.set("user-agent",[o,...t].filter(Boolean).join(" ")),Object.fromEntries(n.entries())}function K(e){return null!=e}var L=/"__proto__"\s*:/,D=/"constructor"\s*:/;function V(e){let t=JSON.parse(e);return null===t||"object"!=typeof t||!1===L.test(e)&&!1===D.test(e)?t:function(e){let t=[e];for(;t.length;){let e=t;for(let n of(t=[],e)){if(Object.prototype.hasOwnProperty.call(n,"__proto__")||Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let e in n){let o=n[e];o&&"object"==typeof o&&t.push(o)}}}return e}(t)}function H(e){let{stackTraceLimit:t}=Error;try{Error.stackTraceLimit=0}catch(t){return V(e)}try{return V(e)}finally{Error.stackTraceLimit=t}}function B(e){if("object"===e.type||Array.isArray(e.type)&&e.type.includes("object")){e.additionalProperties=!1;let{properties:t}=e;if(null!=t)for(let e of Object.keys(t))t[e]=W(t[e])}null!=e.items&&(e.items=Array.isArray(e.items)?e.items.map(W):W(e.items)),null!=e.anyOf&&(e.anyOf=e.anyOf.map(W)),null!=e.allOf&&(e.allOf=e.allOf.map(W)),null!=e.oneOf&&(e.oneOf=e.oneOf.map(W));let{definitions:t}=e;if(null!=t)for(let e of Object.keys(t))t[e]=W(t[e]);return e}function W(e){return"boolean"==typeof e?e:B(e)}var G=Symbol("Let zodToJsonSchema decide on which parser to use"),J={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"};function Y(e,t){return ez(e.type._def,t)}var X=void 0,Q=/^[cC][^\s-]{8,}$/,ee=/^[0-9a-z]+$/,et=/^[0-9A-HJKMNP-TV-Z]{26}$/,en=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,eo=()=>(void 0===X&&(X=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),X),er=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ei=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ea=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,es=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,el=/^[a-zA-Z0-9_-]{21}$/,eu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function ed(e,t){let n={type:"string"};if(e.checks)for(let o of e.checks)switch(o.kind){case"min":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,o.value):o.value;break;case"max":n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,o.value):o.value;break;case"email":switch(t.emailStrategy){case"format:email":em(n,"email",o.message,t);break;case"format:idn-email":em(n,"idn-email",o.message,t);break;case"pattern:zod":eg(n,en,o.message,t)}break;case"url":em(n,"uri",o.message,t);break;case"uuid":em(n,"uuid",o.message,t);break;case"regex":eg(n,o.regex,o.message,t);break;case"cuid":eg(n,Q,o.message,t);break;case"cuid2":eg(n,ee,o.message,t);break;case"startsWith":eg(n,RegExp(`^${ep(o.value,t)}`),o.message,t);break;case"endsWith":eg(n,RegExp(`${ep(o.value,t)}$`),o.message,t);break;case"datetime":em(n,"date-time",o.message,t);break;case"date":em(n,"date",o.message,t);break;case"time":em(n,"time",o.message,t);break;case"duration":em(n,"duration",o.message,t);break;case"length":n.minLength="number"==typeof n.minLength?Math.max(n.minLength,o.value):o.value,n.maxLength="number"==typeof n.maxLength?Math.min(n.maxLength,o.value):o.value;break;case"includes":eg(n,RegExp(ep(o.value,t)),o.message,t);break;case"ip":"v6"!==o.version&&em(n,"ipv4",o.message,t),"v4"!==o.version&&em(n,"ipv6",o.message,t);break;case"base64url":eg(n,es,o.message,t);break;case"jwt":eg(n,eu,o.message,t);break;case"cidr":"v6"!==o.version&&eg(n,er,o.message,t),"v4"!==o.version&&eg(n,ei,o.message,t);break;case"emoji":eg(n,eo(),o.message,t);break;case"ulid":eg(n,et,o.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":em(n,"binary",o.message,t);break;case"contentEncoding:base64":n.contentEncoding="base64";break;case"pattern:zod":eg(n,ea,o.message,t)}break;case"nanoid":eg(n,el,o.message,t)}return n}function ep(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let n=0;n<e.length;n++)ec.has(e[n])||(t+="\\"),t+=e[n];return t}(e):e}var ec=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function em(e,t,n,o){var r;e.format||(null==(r=e.anyOf)?void 0:r.some(e=>e.format))?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...n&&o.errorMessages&&{errorMessage:{format:n}}})):e.format=t}function eg(e,t,n,o){var r;e.pattern||(null==(r=e.allOf)?void 0:r.some(e=>e.pattern))?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:eh(t,o),...n&&o.errorMessages&&{errorMessage:{pattern:n}}})):e.pattern=eh(t,o)}function eh(e,t){var n;if(!t.applyRegexFlags||!e.flags)return e.source;let o={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},r=o.i?e.source.toLowerCase():e.source,i="",a=!1,s=!1,l=!1;for(let e=0;e<r.length;e++){if(a){i+=r[e],a=!1;continue}if(o.i){if(s){if(r[e].match(/[a-z]/)){l?(i+=r[e],i+=`${r[e-2]}-${r[e]}`.toUpperCase(),l=!1):"-"===r[e+1]&&(null==(n=r[e+2])?void 0:n.match(/[a-z]/))?(i+=r[e],l=!0):i+=`${r[e]}${r[e].toUpperCase()}`;continue}}else if(r[e].match(/[a-z]/)){i+=`[${r[e]}${r[e].toUpperCase()}]`;continue}}if(o.m){if("^"===r[e]){i+=`(^|(?<=[\r
]))`;continue}else if("$"===r[e]){i+=`($|(?=[\r
]))`;continue}}if(o.s&&"."===r[e]){i+=s?`${r[e]}\r
`:`[${r[e]}\r
]`;continue}i+=r[e],"\\"===r[e]?a=!0:s&&"]"===r[e]?s=!1:s||"["!==r[e]||(s=!0)}try{new RegExp(i)}catch(n){return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return i}function ef(e,t){var n,o,r,i,a,s;let l={type:"object",additionalProperties:null!=(n=ez(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))?n:t.allowedAdditionalProperties};if((null==(o=e.keyType)?void 0:o._def.typeName)===j.ZodFirstPartyTypeKind.ZodString&&(null==(r=e.keyType._def.checks)?void 0:r.length)){let{type:n,...o}=ed(e.keyType._def,t);return{...l,propertyNames:o}}if((null==(i=e.keyType)?void 0:i._def.typeName)===j.ZodFirstPartyTypeKind.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if((null==(a=e.keyType)?void 0:a._def.typeName)===j.ZodFirstPartyTypeKind.ZodBranded&&e.keyType._def.type._def.typeName===j.ZodFirstPartyTypeKind.ZodString&&(null==(s=e.keyType._def.type._def.checks)?void 0:s.length)){let{type:n,...o}=Y(e.keyType._def,t);return{...l,propertyNames:o}}return l}var ey={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ez(e,t,n=!1){var o;let r=t.seen.get(e);if(t.override){let i=null==(o=t.override)?void 0:o.call(t,e,t,r,n);if(i!==G)return i}if(r&&!n){let e=e_(r,t);if(void 0!==e)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let a=((e,t,n)=>{var o,r,i,a,s,l;switch(t){case j.ZodFirstPartyTypeKind.ZodString:return ed(e,n);case j.ZodFirstPartyTypeKind.ZodNumber:let u={type:"number"};if(!e.checks)return u;for(let t of e.checks)switch(t.kind){case"int":u.type="integer";break;case"min":t.inclusive?u.minimum=t.value:u.exclusiveMinimum=t.value;break;case"max":t.inclusive?u.maximum=t.value:u.exclusiveMaximum=t.value;break;case"multipleOf":u.multipleOf=t.value}return u;case j.ZodFirstPartyTypeKind.ZodObject:return function(e,t){let n={type:"object",properties:{}},o=[],r=e.shape();for(let e in r){let i=r[e];if(void 0===i||void 0===i._def)continue;let a=function(e){try{return e.isOptional()}catch(e){return!0}}(i),s=ez(i._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==s&&(n.properties[e]=s,a||o.push(e))}o.length&&(n.required=o);let i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return ez(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(n.additionalProperties=i),n}(e,n);case j.ZodFirstPartyTypeKind.ZodBigInt:let d={type:"integer",format:"int64"};if(!e.checks)return d;for(let t of e.checks)switch(t.kind){case"min":t.inclusive?d.minimum=t.value:d.exclusiveMinimum=t.value;break;case"max":t.inclusive?d.maximum=t.value:d.exclusiveMaximum=t.value;break;case"multipleOf":d.multipleOf=t.value}return d;case j.ZodFirstPartyTypeKind.ZodBoolean:return{type:"boolean"};case j.ZodFirstPartyTypeKind.ZodDate:return function e(t,n,o){let r=null!=o?o:n.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((o,r)=>e(t,n,o))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var i=t;let a={type:"integer",format:"unix-time"};for(let e of i.checks)switch(e.kind){case"min":a.minimum=e.value;break;case"max":a.maximum=e.value}return a}}(e,n);case j.ZodFirstPartyTypeKind.ZodUndefined:return{not:{}};case j.ZodFirstPartyTypeKind.ZodNull:return{type:"null"};case j.ZodFirstPartyTypeKind.ZodArray:let p;return p={type:"array"},(null==(i=e.type)?void 0:i._def)&&(null==(s=null==(a=e.type)?void 0:a._def)?void 0:s.typeName)!==j.ZodFirstPartyTypeKind.ZodAny&&(p.items=ez(e.type._def,{...n,currentPath:[...n.currentPath,"items"]})),e.minLength&&(p.minItems=e.minLength.value),e.maxLength&&(p.maxItems=e.maxLength.value),e.exactLength&&(p.minItems=e.exactLength.value,p.maxItems=e.exactLength.value),p;case j.ZodFirstPartyTypeKind.ZodUnion:case j.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:let c,m=e.options instanceof Map?Array.from(e.options.values()):e.options;if(m.every(e=>e._def.typeName in ey&&(!e._def.checks||!e._def.checks.length))){let e=m.reduce((e,t)=>{let n=ey[t._def.typeName];return n&&!e.includes(n)?[...e,n]:e},[]);return{type:e.length>1?e:e[0]}}if(m.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=m.reduce((e,t)=>{let n=typeof t._def.value;switch(n){case"string":case"number":case"boolean":return[...e,n];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===m.length){let t=e.filter((e,t,n)=>n.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:m.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(m.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:m.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return o=e,r=n,(c=(o.options instanceof Map?Array.from(o.options.values()):o.options).map((e,t)=>ez(e._def,{...r,currentPath:[...r.currentPath,"anyOf",`${t}`]})).filter(e=>!!e&&(!r.strictUnions||"object"==typeof e&&Object.keys(e).length>0))).length?{anyOf:c}:void 0;case j.ZodFirstPartyTypeKind.ZodIntersection:let g,h;return g=[ez(e.left._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),ez(e.right._def,{...n,currentPath:[...n.currentPath,"allOf","1"]})].filter(e=>!!e),h=[],g.forEach(e=>{if((!("type"in e)||"string"!==e.type)&&"allOf"in e)h.push(...e.allOf);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:n,...o}=e;t=o}h.push(t)}}),h.length?{allOf:h}:void 0;case j.ZodFirstPartyTypeKind.ZodTuple:return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,t)=>ez(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:ez(e.rest._def,{...n,currentPath:[...n.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,t)=>ez(e._def,{...n,currentPath:[...n.currentPath,"items",`${t}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])};case j.ZodFirstPartyTypeKind.ZodRecord:return ef(e,n);case j.ZodFirstPartyTypeKind.ZodLiteral:let f;return"bigint"!=(f=typeof e.value)&&"number"!==f&&"boolean"!==f&&"string"!==f?{type:Array.isArray(e.value)?"array":"object"}:{type:"bigint"===f?"integer":f,const:e.value};case j.ZodFirstPartyTypeKind.ZodEnum:return{type:"string",enum:Array.from(e.values)};case j.ZodFirstPartyTypeKind.ZodNativeEnum:let y,z,_;return y=e.values,{type:1===(_=Array.from(new Set((z=Object.keys(e.values).filter(e=>"number"!=typeof y[y[e]]).map(e=>y[e])).map(e=>typeof e)))).length?"string"===_[0]?"string":"number":["string","number"],enum:z};case j.ZodFirstPartyTypeKind.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[ey[e.innerType._def.typeName],"null"]};let v=ez(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","0"]});return v&&{anyOf:[v,{type:"null"}]};case j.ZodFirstPartyTypeKind.ZodOptional:if(n.currentPath.toString()===(null==(l=n.propertyPath)?void 0:l.toString()))return ez(e.innerType._def,n);let b=ez(e.innerType._def,{...n,currentPath:[...n.currentPath,"anyOf","1"]});return b?{anyOf:[{not:{}},b]}:{};case j.ZodFirstPartyTypeKind.ZodMap:if("record"===n.mapStrategy)return ef(e,n);return{type:"array",maxItems:125,items:{type:"array",items:[ez(e.keyType._def,{...n,currentPath:[...n.currentPath,"items","items","0"]})||{},ez(e.valueType._def,{...n,currentPath:[...n.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}};case j.ZodFirstPartyTypeKind.ZodSet:let w;return w={type:"array",uniqueItems:!0,items:ez(e.valueType._def,{...n,currentPath:[...n.currentPath,"items"]})},e.minSize&&(w.minItems=e.minSize.value),e.maxSize&&(w.maxItems=e.maxSize.value),w;case j.ZodFirstPartyTypeKind.ZodLazy:return()=>e.getter()._def;case j.ZodFirstPartyTypeKind.ZodPromise:return ez(e.type._def,n);case j.ZodFirstPartyTypeKind.ZodNaN:case j.ZodFirstPartyTypeKind.ZodNever:return{not:{}};case j.ZodFirstPartyTypeKind.ZodEffects:return"input"===n.effectStrategy?ez(e.schema._def,n):{};case j.ZodFirstPartyTypeKind.ZodAny:case j.ZodFirstPartyTypeKind.ZodUnknown:return{};case j.ZodFirstPartyTypeKind.ZodDefault:return{...ez(e.innerType._def,n),default:e.defaultValue()};case j.ZodFirstPartyTypeKind.ZodBranded:return Y(e,n);case j.ZodFirstPartyTypeKind.ZodReadonly:case j.ZodFirstPartyTypeKind.ZodCatch:return ez(e.innerType._def,n);case j.ZodFirstPartyTypeKind.ZodPipeline:if("input"===n.pipeStrategy)return ez(e.in._def,n);if("output"===n.pipeStrategy)return ez(e.out._def,n);let x=ez(e.in._def,{...n,currentPath:[...n.currentPath,"allOf","0"]}),k=ez(e.out._def,{...n,currentPath:[...n.currentPath,"allOf",x?"1":"0"]});return{allOf:[x,k].filter(e=>void 0!==e)};case j.ZodFirstPartyTypeKind.ZodFunction:case j.ZodFirstPartyTypeKind.ZodVoid:case j.ZodFirstPartyTypeKind.ZodSymbol:default:return}})(e,e.typeName,t),s="function"==typeof a?ez(a(),t):a;if(s&&ev(e,t,s),t.postProcess){let n=t.postProcess(s,e,t);return i.jsonSchema=s,n}return i.jsonSchema=s,s}var e_=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:((e,t)=>{let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);return[(e.length-n).toString(),...t.slice(n)].join("/")})(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,n)=>t.currentPath[n]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},ev=(e,t,n)=>(e.description&&(n.description=e.description),n),eb=Symbol.for("vercel.ai.schema");function ew(e){let t;return()=>(null==t&&(t=e()),t)}function ex(e,{validate:t}={}){return{[eb]:!0,_type:void 0,get jsonSchema(){return"function"==typeof e&&(e=e()),e},validate:t}}function ek(e,t){var n,o;let r;if("_zod"in e){let o;return o=null!=(n=null==t?void 0:t.useReferences)&&n,ex(()=>B(k.toJSONSchema(e,{target:"draft-7",io:"input",reused:o?"ref":"inline"})),{validate:async t=>{let n=await x.safeParseAsync(e,t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}return r=null!=(o=null==t?void 0:t.useReferences)&&o,ex(()=>((e,t)=>{var n;let o,r,i=(r=void 0!==(o="string"==typeof t?{...J,name:t}:{...J,...t}).name?[...o.basePath,o.definitionPath,o.name]:o.basePath,{...o,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(o.definitions).map(([e,t])=>[t._def,{def:t._def,path:[...o.basePath,o.definitionPath,e],jsonSchema:void 0}]))}),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,n])=>{var o;return{...e,[t]:null!=(o=ez(n._def,{...i,currentPath:[...i.basePath,i.definitionPath,t]},!0))?o:{}}},{}):void 0,s="string"==typeof t?t:(null==t?void 0:t.nameStrategy)==="title"||null==t?void 0:t.name,l=null!=(n=ez(e._def,void 0===s?i:{...i,currentPath:[...i.basePath,i.definitionPath,s]},!1))?n:{},u="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==u&&(l.title=u);let d=void 0===s?a?{...l,[i.definitionPath]:a}:l:{$ref:[..."relative"===i.$refStrategy?[]:i.basePath,i.definitionPath,s].join("/"),[i.definitionPath]:{...a,[s]:l}};return d.$schema="http://json-schema.org/draft-07/schema#",d})(e,{$refStrategy:r?"root":"none"}),{validate:async t=>{let n=await e.safeParseAsync(t);return n.success?{success:!0,value:n.data}:{success:!1,error:n.error}}})}async function ej({value:e,schema:t}){let n=await eI({value:e,schema:t});if(!n.success)throw w.TypeValidationError.wrap({value:e,cause:n.error});return n.value}async function eI({value:e,schema:t}){var n;let o=null==t?ex({properties:{},additionalProperties:!1}):"object"==typeof t&&null!==t&&eb in t&&!0===t[eb]&&"jsonSchema"in t&&"validate"in t?t:"~standard"in t?"zod"===t["~standard"].vendor?ek(t):(n=t,ex(()=>n["~standard"].jsonSchema.input({target:"draft-07"}),{validate:async e=>{let t=await n["~standard"].validate(e);return"value"in t?{success:!0,value:t.value}:{success:!1,error:new w.TypeValidationError({value:e,cause:t.issues})}}})):t();try{if(null==o.validate)return{success:!0,value:e,rawValue:e};let t=await o.validate(e);if(t.success)return{success:!0,value:t.value,rawValue:e};return{success:!1,error:w.TypeValidationError.wrap({value:e,cause:t.error}),rawValue:e}}catch(t){return{success:!1,error:w.TypeValidationError.wrap({value:e,cause:t}),rawValue:e}}}async function eT({text:e,schema:t}){try{let n=H(e);if(null==t)return n;return ej({value:n,schema:t})}catch(t){if(w.JSONParseError.isInstance(t)||w.TypeValidationError.isInstance(t))throw t;throw new w.JSONParseError({text:e,cause:t})}}async function eP({text:e,schema:t}){try{let n=H(e);if(null==t)return{success:!0,value:n,rawValue:n};return await eI({value:n,schema:t})}catch(t){return{success:!1,error:w.JSONParseError.isInstance(t)?t:new w.JSONParseError({text:e,cause:t}),rawValue:void 0}}}function eC(e){try{return H(e),!0}catch(e){return!1}}async function eN({provider:e,providerOptions:t,schema:n}){if((null==t?void 0:t[e])==null)return;let o=await eI({value:t[e],schema:n});if(!o.success)throw new w.InvalidArgumentError({argument:"providerOptions",message:`invalid ${e} provider options`,cause:o.error});return o.value}var eS=()=>globalThis.fetch,eA=async({url:e,headers:t,body:n,failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a})=>eq({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(n),values:n},failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a}),eE=async({url:e,headers:t,formData:n,failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a})=>eq({url:e,headers:t,body:{content:n,values:Object.fromEntries(n.entries())},failedResponseHandler:o,successfulResponseHandler:r,abortSignal:i,fetch:a}),eq=async({url:e,headers:t={},body:n,successfulResponseHandler:o,failedResponseHandler:r,abortSignal:i,fetch:a=eS()})=>{try{let s=await a(e,{method:"POST",headers:U(t,"ai-sdk/provider-utils/4.0.3",function(e=globalThis){var t,n,o;return e.window?"runtime/browser":(null==(t=e.navigator)?void 0:t.userAgent)?`runtime/${e.navigator.userAgent.toLowerCase()}`:(null==(o=null==(n=e.process)?void 0:n.versions)?void 0:o.node)?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}()),body:n.content,signal:i}),l=P(s);if(!s.ok){let t;try{t=await r({response:s,url:e,requestBodyValues:n.values})}catch(t){if(Z(t)||w.APICallError.isInstance(t))throw t;throw new w.APICallError({message:"Failed to process error response",cause:t,statusCode:s.status,url:e,responseHeaders:l,requestBodyValues:n.values})}throw t.value}try{return await o({response:s,url:e,requestBodyValues:n.values})}catch(t){if(t instanceof Error&&(Z(t)||w.APICallError.isInstance(t)))throw t;throw new w.APICallError({message:"Failed to process successful response",cause:t,statusCode:s.status,url:e,responseHeaders:l,requestBodyValues:n.values})}}catch(t){throw function({error:e,url:t,requestBodyValues:n}){if(Z(e))return e;if(e instanceof TypeError&&F.includes(e.message.toLowerCase())){let o=e.cause;if(null!=o)return new w.APICallError({message:`Cannot connect to API: ${o.message}`,cause:o,url:t,requestBodyValues:n,isRetryable:!0})}return e}({error:t,url:e,requestBodyValues:n.values})}};function eR({id:e,inputSchema:t,outputSchema:n,supportsDeferredResults:o}){return({execute:r,needsApproval:i,toModelOutput:a,onInputStart:s,onInputDelta:l,onInputAvailable:u,...d})=>({type:"provider",id:e,args:d,inputSchema:t,outputSchema:n,execute:r,needsApproval:i,toModelOutput:a,onInputStart:s,onInputDelta:l,onInputAvailable:u,supportsDeferredResults:o})}var e$=e=>async({response:t})=>{let n=P(t);if(null==t.body)throw new w.EmptyResponseBodyError({});return{responseHeaders:n,value:function({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new I.EventSourceParserStream).pipeThrough(new TransformStream({async transform({data:e},n){"[DONE]"!==e&&n.enqueue(await eP({text:e,schema:t}))}}))}({stream:t.body,schema:e})}},eO=e=>async({response:t,url:n,requestBodyValues:o})=>{let r=await t.text(),i=await eP({text:r,schema:e}),a=P(t);if(!i.success)throw new w.APICallError({message:"Invalid JSON response",cause:i.error,statusCode:t.status,responseHeaders:a,responseBody:r,url:n,requestBodyValues:o});return{responseHeaders:a,value:i.value,rawValue:i.rawValue}},eM=e.i(69719),eZ=eM.z.object({error:eM.z.object({message:eM.z.string(),type:eM.z.string().nullish(),param:eM.z.any().nullish(),code:eM.z.union([eM.z.string(),eM.z.number()]).nullish()})}),eF=(({errorSchema:e,errorToMessage:t,isRetryable:n})=>async({response:o,url:r,requestBodyValues:i})=>{let a=await o.text(),s=P(o);if(""===a.trim())return{responseHeaders:s,value:new w.APICallError({message:o.statusText,url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,isRetryable:null==n?void 0:n(o)})};try{let l=await eT({text:a,schema:e});return{responseHeaders:s,value:new w.APICallError({message:t(l),url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,data:l,isRetryable:null==n?void 0:n(o,l)})}}catch(e){return{responseHeaders:s,value:new w.APICallError({message:o.statusText,url:r,requestBodyValues:i,statusCode:o.status,responseHeaders:s,responseBody:a,isRetryable:null==n?void 0:n(o)})}}})({errorSchema:eZ,errorToMessage:e=>e.error.message});function eU(e){let t=e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),n=e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini"),o=e.startsWith("o1")||e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("codex-mini")||e.startsWith("computer-use-preview")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat");return{supportsFlexProcessing:t,supportsPriorityProcessing:n,isReasoningModel:o,systemMessageMode:o?"developer":"system",supportsNonReasoningParameters:e.startsWith("gpt-5.1")||e.startsWith("gpt-5.2")}}function eK(e){var t,n,o,r,i,a;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let s=null!=(t=e.prompt_tokens)?t:0,l=null!=(n=e.completion_tokens)?n:0,u=null!=(r=null==(o=e.prompt_tokens_details)?void 0:o.cached_tokens)?r:0,d=null!=(a=null==(i=e.completion_tokens_details)?void 0:i.reasoning_tokens)?a:0;return{inputTokens:{total:s,noCache:s-u,cacheRead:u,cacheWrite:void 0},outputTokens:{total:l,text:l-d,reasoning:d},raw:e}}function eL({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:n?new Date(1e3*n):void 0}}function eD(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var eV=ew(()=>ek(eM.z.object({id:eM.z.string().nullish(),created:eM.z.number().nullish(),model:eM.z.string().nullish(),choices:eM.z.array(eM.z.object({message:eM.z.object({role:eM.z.literal("assistant").nullish(),content:eM.z.string().nullish(),tool_calls:eM.z.array(eM.z.object({id:eM.z.string().nullish(),type:eM.z.literal("function"),function:eM.z.object({name:eM.z.string(),arguments:eM.z.string()})})).nullish(),annotations:eM.z.array(eM.z.object({type:eM.z.literal("url_citation"),url_citation:eM.z.object({start_index:eM.z.number(),end_index:eM.z.number(),url:eM.z.string(),title:eM.z.string()})})).nullish()}),index:eM.z.number(),logprobs:eM.z.object({content:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number(),top_logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number()}))})).nullish()}).nullish(),finish_reason:eM.z.string().nullish()})),usage:eM.z.object({prompt_tokens:eM.z.number().nullish(),completion_tokens:eM.z.number().nullish(),total_tokens:eM.z.number().nullish(),prompt_tokens_details:eM.z.object({cached_tokens:eM.z.number().nullish()}).nullish(),completion_tokens_details:eM.z.object({reasoning_tokens:eM.z.number().nullish(),accepted_prediction_tokens:eM.z.number().nullish(),rejected_prediction_tokens:eM.z.number().nullish()}).nullish()}).nullish()}))),eH=ew(()=>ek(eM.z.union([eM.z.object({id:eM.z.string().nullish(),created:eM.z.number().nullish(),model:eM.z.string().nullish(),choices:eM.z.array(eM.z.object({delta:eM.z.object({role:eM.z.enum(["assistant"]).nullish(),content:eM.z.string().nullish(),tool_calls:eM.z.array(eM.z.object({index:eM.z.number(),id:eM.z.string().nullish(),type:eM.z.literal("function").nullish(),function:eM.z.object({name:eM.z.string().nullish(),arguments:eM.z.string().nullish()})})).nullish(),annotations:eM.z.array(eM.z.object({type:eM.z.literal("url_citation"),url_citation:eM.z.object({start_index:eM.z.number(),end_index:eM.z.number(),url:eM.z.string(),title:eM.z.string()})})).nullish()}).nullish(),logprobs:eM.z.object({content:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number(),top_logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number()}))})).nullish()}).nullish(),finish_reason:eM.z.string().nullish(),index:eM.z.number()})),usage:eM.z.object({prompt_tokens:eM.z.number().nullish(),completion_tokens:eM.z.number().nullish(),total_tokens:eM.z.number().nullish(),prompt_tokens_details:eM.z.object({cached_tokens:eM.z.number().nullish()}).nullish(),completion_tokens_details:eM.z.object({reasoning_tokens:eM.z.number().nullish(),accepted_prediction_tokens:eM.z.number().nullish(),rejected_prediction_tokens:eM.z.number().nullish()}).nullish()}).nullish()}),eZ]))),eB=ew(()=>ek(eM.z.object({logitBias:eM.z.record(eM.z.coerce.number(),eM.z.number()).optional(),logprobs:eM.z.union([eM.z.boolean(),eM.z.number()]).optional(),parallelToolCalls:eM.z.boolean().optional(),user:eM.z.string().optional(),reasoningEffort:eM.z.enum(["none","minimal","low","medium","high","xhigh"]).optional(),maxCompletionTokens:eM.z.number().optional(),store:eM.z.boolean().optional(),metadata:eM.z.record(eM.z.string().max(64),eM.z.string().max(512)).optional(),prediction:eM.z.record(eM.z.string(),eM.z.any()).optional(),serviceTier:eM.z.enum(["auto","flex","priority","default"]).optional(),strictJsonSchema:eM.z.boolean().optional(),textVerbosity:eM.z.enum(["low","medium","high"]).optional(),promptCacheKey:eM.z.string().optional(),promptCacheRetention:eM.z.enum(["in_memory","24h"]).optional(),safetyIdentifier:eM.z.string().optional(),systemMessageMode:eM.z.enum(["system","developer","remove"]).optional(),forceReasoning:eM.z.boolean().optional()}))),eW=class{constructor(e,t){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:o,topK:r,frequencyPenalty:i,presencePenalty:a,stopSequences:s,responseFormat:l,seed:u,tools:d,toolChoice:p,providerOptions:c}){var m,g,h,f,y;let z=[],_=null!=(m=await eN({provider:"openai",providerOptions:c,schema:eB}))?m:{},v=eU(this.modelId),b=null!=(g=_.forceReasoning)?g:v.isReasoningModel;null!=r&&z.push({type:"unsupported",feature:"topK"});let{messages:x,warnings:k}=function({prompt:e,systemMessageMode:t="system"}){var n;let o=[],r=[];for(let{role:i,content:a}of e)switch(i){case"system":switch(t){case"system":o.push({role:"system",content:a});break;case"developer":o.push({role:"developer",content:a});break;case"remove":r.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":if(1===a.length&&"text"===a[0].type){o.push({role:"user",content:a[0].text});break}o.push({role:"user",content:a.map((e,t)=>{var n,o,r;switch(e.type){case"text":return{type:"text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"image_url",image_url:{url:e.data instanceof URL?e.data.toString():`data:${t};base64,${A(e.data)}`,detail:null==(o=null==(n=e.providerOptions)?void 0:n.openai)?void 0:o.imageDetail}}}if(e.mediaType.startsWith("audio/")){if(e.data instanceof URL)throw new w.UnsupportedFunctionalityError({functionality:"audio file parts with URLs"});switch(e.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:A(e.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:A(e.data),format:"mp3"}};default:throw new w.UnsupportedFunctionalityError({functionality:`audio content parts with media type ${e.mediaType}`})}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)throw new w.UnsupportedFunctionalityError({functionality:"PDF file parts with URLs"});return{type:"file",file:"string"==typeof e.data&&e.data.startsWith("file-")?{file_id:e.data}:{filename:null!=(r=e.filename)?r:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${A(e.data)}`}}}else throw new w.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e="",t=[];for(let n of a)switch(n.type){case"text":e+=n.text;break;case"tool-call":t.push({id:n.toolCallId,type:"function",function:{name:n.toolName,arguments:JSON.stringify(n.input)}})}o.push({role:"assistant",content:e,tool_calls:t.length>0?t:void 0});break}case"tool":for(let e of a){let t;if("tool-approval-response"===e.type)continue;let r=e.output;switch(r.type){case"text":case"error-text":t=r.value;break;case"execution-denied":t=null!=(n=r.reason)?n:"Tool execution denied.";break;case"content":case"json":case"error-json":t=JSON.stringify(r.value)}o.push({role:"tool",tool_call_id:e.toolCallId,content:t})}break;default:throw Error(`Unsupported role: ${i}`)}return{messages:o,warnings:r}}({prompt:e,systemMessageMode:null!=(h=_.systemMessageMode)?h:b?"developer":v.systemMessageMode});z.push(...k);let j=null==(f=_.strictJsonSchema)||f,I={model:this.modelId,logit_bias:_.logitBias,logprobs:!0===_.logprobs||"number"==typeof _.logprobs||void 0,top_logprobs:"number"==typeof _.logprobs?_.logprobs:"boolean"==typeof _.logprobs&&_.logprobs?0:void 0,user:_.user,parallel_tool_calls:_.parallelToolCalls,max_tokens:t,temperature:n,top_p:o,frequency_penalty:i,presence_penalty:a,response_format:(null==l?void 0:l.type)==="json"?null!=l.schema?{type:"json_schema",json_schema:{schema:l.schema,strict:j,name:null!=(y=l.name)?y:"response",description:l.description}}:{type:"json_object"}:void 0,stop:s,seed:u,verbosity:_.textVerbosity,max_completion_tokens:_.maxCompletionTokens,store:_.store,metadata:_.metadata,prediction:_.prediction,reasoning_effort:_.reasoningEffort,service_tier:_.serviceTier,prompt_cache_key:_.promptCacheKey,prompt_cache_retention:_.promptCacheRetention,safety_identifier:_.safetyIdentifier,messages:x};b?("none"===_.reasoningEffort&&v.supportsNonReasoningParameters||(null!=I.temperature&&(I.temperature=void 0,z.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),null!=I.top_p&&(I.top_p=void 0,z.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"})),null!=I.logprobs&&(I.logprobs=void 0,z.push({type:"other",message:"logprobs is not supported for reasoning models"}))),null!=I.frequency_penalty&&(I.frequency_penalty=void 0,z.push({type:"unsupported",feature:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=I.presence_penalty&&(I.presence_penalty=void 0,z.push({type:"unsupported",feature:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=I.logit_bias&&(I.logit_bias=void 0,z.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=I.top_logprobs&&(I.top_logprobs=void 0,z.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=I.max_tokens&&(null==I.max_completion_tokens&&(I.max_completion_tokens=I.max_tokens),I.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=I.temperature&&(I.temperature=void 0,z.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),"flex"!==_.serviceTier||v.supportsFlexProcessing||(z.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),I.service_tier=void 0),"priority"!==_.serviceTier||v.supportsPriorityProcessing||(z.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),I.service_tier=void 0);let{tools:T,toolChoice:P,toolWarnings:C}=function({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let o=[];for(let t of e)"function"===t.type?o.push({type:"function",function:{name:t.name,description:t.description,parameters:t.inputSchema,...null!=t.strict?{strict:t.strict}:{}}}):n.push({type:"unsupported",feature:`tool type: ${t.type}`});if(null==t)return{tools:o,toolChoice:void 0,toolWarnings:n};let r=t.type;switch(r){case"auto":case"none":case"required":return{tools:o,toolChoice:r,toolWarnings:n};case"tool":return{tools:o,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:n};default:throw new w.UnsupportedFunctionalityError({functionality:`tool choice type: ${r}`})}}({tools:d,toolChoice:p});return{args:{...I,tools:T,tool_choice:P},warnings:[...z,...C]}}async doGenerate(e){var t,n,o,r,i,a,s;let{args:l,warnings:u}=await this.getArgs(e),{responseHeaders:d,value:p,rawValue:c}=await eA({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:l,failedResponseHandler:eF,successfulResponseHandler:eO(eV),abortSignal:e.abortSignal,fetch:this.config.fetch}),m=p.choices[0],g=[],h=m.message.content;for(let e of(null!=h&&h.length>0&&g.push({type:"text",text:h}),null!=(t=m.message.tool_calls)?t:[]))g.push({type:"tool-call",toolCallId:null!=(n=e.id)?n:M(),toolName:e.function.name,input:e.function.arguments});for(let e of null!=(o=m.message.annotations)?o:[])g.push({type:"source",sourceType:"url",id:M(),url:e.url_citation.url,title:e.url_citation.title});let f=null==(r=p.usage)?void 0:r.completion_tokens_details;null==(i=p.usage)||i.prompt_tokens_details;let y={openai:{}};return(null==f?void 0:f.accepted_prediction_tokens)!=null&&(y.openai.acceptedPredictionTokens=null==f?void 0:f.accepted_prediction_tokens),(null==f?void 0:f.rejected_prediction_tokens)!=null&&(y.openai.rejectedPredictionTokens=null==f?void 0:f.rejected_prediction_tokens),(null==(a=m.logprobs)?void 0:a.content)!=null&&(y.openai.logprobs=m.logprobs.content),{content:g,finishReason:{unified:eD(m.finish_reason),raw:null!=(s=m.finish_reason)?s:void 0},usage:eK(p.usage),request:{body:l},response:{...eL(p),headers:d,body:c},warnings:u,providerMetadata:y}}async doStream(e){let t,{args:n,warnings:o}=await this.getArgs(e),r={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await eA({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:r,failedResponseHandler:eF,successfulResponseHandler:e$(eH),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=[],l={unified:"other",raw:void 0},u=!1,d=!1,p={openai:{}};return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(n,o){var r,i,a,c,m,g,h,f,y,z,_,v,b,x,k,j,I;if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){l={unified:"error",raw:void 0},o.enqueue({type:"error",error:n.error});return}let T=n.value;if("error"in T){l={unified:"error",raw:void 0},o.enqueue({type:"error",error:T.error});return}!u&&Object.values(eL(T)).some(Boolean)&&(u=!0,o.enqueue({type:"response-metadata",...eL(T)})),null!=T.usage&&(t=T.usage,(null==(r=T.usage.completion_tokens_details)?void 0:r.accepted_prediction_tokens)!=null&&(p.openai.acceptedPredictionTokens=null==(i=T.usage.completion_tokens_details)?void 0:i.accepted_prediction_tokens),(null==(a=T.usage.completion_tokens_details)?void 0:a.rejected_prediction_tokens)!=null&&(p.openai.rejectedPredictionTokens=null==(c=T.usage.completion_tokens_details)?void 0:c.rejected_prediction_tokens));let P=T.choices[0];if((null==P?void 0:P.finish_reason)!=null&&(l={unified:eD(P.finish_reason),raw:P.finish_reason}),(null==(m=null==P?void 0:P.logprobs)?void 0:m.content)!=null&&(p.openai.logprobs=P.logprobs.content),(null==P?void 0:P.delta)==null)return;let C=P.delta;if(null!=C.content&&(d||(o.enqueue({type:"text-start",id:"0"}),d=!0),o.enqueue({type:"text-delta",id:"0",delta:C.content})),null!=C.tool_calls)for(let e of C.tool_calls){let t=e.index;if(null==s[t]){if("function"!==e.type)throw new w.InvalidResponseDataError({data:e,message:"Expected 'function' type."});if(null==e.id)throw new w.InvalidResponseDataError({data:e,message:"Expected 'id' to be a string."});if((null==(g=e.function)?void 0:g.name)==null)throw new w.InvalidResponseDataError({data:e,message:"Expected 'function.name' to be a string."});o.enqueue({type:"tool-input-start",id:e.id,toolName:e.function.name}),s[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(h=e.function.arguments)?h:""},hasFinished:!1};let n=s[t];(null==(f=n.function)?void 0:f.name)!=null&&(null==(y=n.function)?void 0:y.arguments)!=null&&(n.function.arguments.length>0&&o.enqueue({type:"tool-input-delta",id:n.id,delta:n.function.arguments}),eC(n.function.arguments)&&(o.enqueue({type:"tool-input-end",id:n.id}),o.enqueue({type:"tool-call",toolCallId:null!=(z=n.id)?z:M(),toolName:n.function.name,input:n.function.arguments}),n.hasFinished=!0));continue}let n=s[t];!n.hasFinished&&((null==(_=e.function)?void 0:_.arguments)!=null&&(n.function.arguments+=null!=(b=null==(v=e.function)?void 0:v.arguments)?b:""),o.enqueue({type:"tool-input-delta",id:n.id,delta:null!=(x=e.function.arguments)?x:""}),(null==(k=n.function)?void 0:k.name)!=null&&(null==(j=n.function)?void 0:j.arguments)!=null&&eC(n.function.arguments)&&(o.enqueue({type:"tool-input-end",id:n.id}),o.enqueue({type:"tool-call",toolCallId:null!=(I=n.id)?I:M(),toolName:n.function.name,input:n.function.arguments}),n.hasFinished=!0))}if(null!=C.annotations)for(let e of C.annotations)o.enqueue({type:"source",sourceType:"url",id:M(),url:e.url_citation.url,title:e.url_citation.title})},flush(e){d&&e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:l,usage:eK(t),...null!=p?{providerMetadata:p}:{}})}})),request:{body:r},response:{headers:i}}}};function eG(e){var t,n,o,r;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let i=null!=(t=e.prompt_tokens)?t:0,a=null!=(n=e.completion_tokens)?n:0;return{inputTokens:{total:null!=(o=e.prompt_tokens)?o:void 0,noCache:i,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:null!=(r=e.completion_tokens)?r:void 0,text:a,reasoning:void 0},raw:e}}function eJ({id:e,model:t,created:n}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=n?new Date(1e3*n):void 0}}function eY(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"other"}}var eX=ew(()=>ek(eM.z.object({id:eM.z.string().nullish(),created:eM.z.number().nullish(),model:eM.z.string().nullish(),choices:eM.z.array(eM.z.object({text:eM.z.string(),finish_reason:eM.z.string(),logprobs:eM.z.object({tokens:eM.z.array(eM.z.string()),token_logprobs:eM.z.array(eM.z.number()),top_logprobs:eM.z.array(eM.z.record(eM.z.string(),eM.z.number())).nullish()}).nullish()})),usage:eM.z.object({prompt_tokens:eM.z.number(),completion_tokens:eM.z.number(),total_tokens:eM.z.number()}).nullish()}))),eQ=ew(()=>ek(eM.z.union([eM.z.object({id:eM.z.string().nullish(),created:eM.z.number().nullish(),model:eM.z.string().nullish(),choices:eM.z.array(eM.z.object({text:eM.z.string(),finish_reason:eM.z.string().nullish(),index:eM.z.number(),logprobs:eM.z.object({tokens:eM.z.array(eM.z.string()),token_logprobs:eM.z.array(eM.z.number()),top_logprobs:eM.z.array(eM.z.record(eM.z.string(),eM.z.number())).nullish()}).nullish()})),usage:eM.z.object({prompt_tokens:eM.z.number(),completion_tokens:eM.z.number(),total_tokens:eM.z.number()}).nullish()}),eZ]))),e0=ew(()=>ek(eM.z.object({echo:eM.z.boolean().optional(),logitBias:eM.z.record(eM.z.string(),eM.z.number()).optional(),suffix:eM.z.string().optional(),user:eM.z.string().optional(),logprobs:eM.z.union([eM.z.boolean(),eM.z.number()]).optional()}))),e1=class{constructor(e,t){this.specificationVersion="v3",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:n,topP:o,topK:r,frequencyPenalty:i,presencePenalty:a,stopSequences:s,responseFormat:l,tools:u,toolChoice:d,seed:p,providerOptions:c}){let m=[],g={...await eN({provider:"openai",providerOptions:c,schema:e0}),...await eN({provider:this.providerOptionsName,providerOptions:c,schema:e0})};null!=r&&m.push({type:"unsupported",feature:"topK"}),(null==u?void 0:u.length)&&m.push({type:"unsupported",feature:"tools"}),null!=d&&m.push({type:"unsupported",feature:"toolChoice"}),null!=l&&"text"!==l.type&&m.push({type:"unsupported",feature:"responseFormat",details:"JSON response format is not supported."});let{prompt:h,stopSequences:f}=function({prompt:e,user:t="user",assistant:n="assistant"}){let o="";for(let{role:r,content:i}of("system"===e[0].role&&(o+=`${e[0].content}

`,e=e.slice(1)),e))switch(r){case"system":throw new w.InvalidPromptError({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=i.map(e=>{if("text"===e.type)return e.text}).filter(Boolean).join("");o+=`${t}:
${e}

`;break}case"assistant":{let e=i.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new w.UnsupportedFunctionalityError({functionality:"tool-call messages"})}}).join("");o+=`${n}:
${e}

`;break}case"tool":throw new w.UnsupportedFunctionalityError({functionality:"tool messages"});default:throw Error(`Unsupported role: ${r}`)}return{prompt:o+=`${n}:
`,stopSequences:[`
${t}:`]}}({prompt:e}),y=[...null!=f?f:[],...null!=s?s:[]];return{args:{model:this.modelId,echo:g.echo,logit_bias:g.logitBias,logprobs:(null==g?void 0:g.logprobs)===!0?0:(null==g?void 0:g.logprobs)===!1||null==g?void 0:g.logprobs,suffix:g.suffix,user:g.user,max_tokens:t,temperature:n,top_p:o,frequency_penalty:i,presence_penalty:a,seed:p,prompt:h,stop:y.length>0?y:void 0},warnings:m}}async doGenerate(e){var t;let{args:n,warnings:o}=await this.getArgs(e),{responseHeaders:r,value:i,rawValue:a}=await eA({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:n,failedResponseHandler:eF,successfulResponseHandler:eO(eX),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=i.choices[0],l={openai:{}};return null!=s.logprobs&&(l.openai.logprobs=s.logprobs),{content:[{type:"text",text:s.text}],usage:eG(i.usage),finishReason:{unified:eY(s.finish_reason),raw:null!=(t=s.finish_reason)?t:void 0},request:{body:n},response:{...eJ(i),headers:r,body:a},providerMetadata:l,warnings:o}}async doStream(e){let t,{args:n,warnings:o}=await this.getArgs(e),r={...n,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:i,value:a}=await eA({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:r,failedResponseHandler:eF,successfulResponseHandler:e$(eQ),abortSignal:e.abortSignal,fetch:this.config.fetch}),s={unified:"other",raw:void 0},l={openai:{}},u=!0;return{stream:a.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:o})},transform(n,o){if(e.includeRawChunks&&o.enqueue({type:"raw",rawValue:n.rawValue}),!n.success){s={unified:"error",raw:void 0},o.enqueue({type:"error",error:n.error});return}let r=n.value;if("error"in r){s={unified:"error",raw:void 0},o.enqueue({type:"error",error:r.error});return}u&&(u=!1,o.enqueue({type:"response-metadata",...eJ(r)}),o.enqueue({type:"text-start",id:"0"})),null!=r.usage&&(t=r.usage);let i=r.choices[0];(null==i?void 0:i.finish_reason)!=null&&(s={unified:eY(i.finish_reason),raw:i.finish_reason}),(null==i?void 0:i.logprobs)!=null&&(l.openai.logprobs=i.logprobs),(null==i?void 0:i.text)!=null&&i.text.length>0&&o.enqueue({type:"text-delta",id:"0",delta:i.text})},flush(e){u||e.enqueue({type:"text-end",id:"0"}),e.enqueue({type:"finish",finishReason:s,providerMetadata:l,usage:eG(t)})}})),request:{body:r},response:{headers:i}}}},e4=ew(()=>ek(eM.z.object({dimensions:eM.z.number().optional(),user:eM.z.string().optional()}))),e2=ew(()=>ek(eM.z.object({data:eM.z.array(eM.z.object({embedding:eM.z.array(eM.z.number())})),usage:eM.z.object({prompt_tokens:eM.z.number()}).nullish()}))),e9=class{constructor(e,t){this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:n,providerOptions:o}){var r;if(e.length>this.maxEmbeddingsPerCall)throw new w.TooManyEmbeddingValuesForCallError({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let i=null!=(r=await eN({provider:"openai",providerOptions:o,schema:e4}))?r:{},{responseHeaders:a,value:s,rawValue:l}=await eA({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:T(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:i.dimensions,user:i.user},failedResponseHandler:eF,successfulResponseHandler:eO(e2),abortSignal:n,fetch:this.config.fetch});return{warnings:[],embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,response:{headers:a,body:l}}}},e5=ew(()=>ek(eM.z.object({created:eM.z.number().nullish(),data:eM.z.array(eM.z.object({b64_json:eM.z.string(),revised_prompt:eM.z.string().nullish()})),background:eM.z.string().nullish(),output_format:eM.z.string().nullish(),size:eM.z.string().nullish(),quality:eM.z.string().nullish(),usage:eM.z.object({input_tokens:eM.z.number().nullish(),output_tokens:eM.z.number().nullish(),total_tokens:eM.z.number().nullish(),input_tokens_details:eM.z.object({image_tokens:eM.z.number().nullish(),text_tokens:eM.z.number().nullish()}).nullish()}).nullish()}))),e3={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10,"gpt-image-1.5":10},e6=new Set(["gpt-image-1","gpt-image-1-mini","gpt-image-1.5"]),e7=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3"}get maxImagesPerCall(){var e;return null!=(e=e3[this.modelId])?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,files:t,mask:n,n:o,size:r,aspectRatio:i,seed:a,providerOptions:s,headers:l,abortSignal:u}){var d,p,c,m,g,h,f,y,z,_,v;let b=[];null!=i&&b.push({type:"unsupported",feature:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=a&&b.push({type:"unsupported",feature:"seed"});let w=null!=(c=null==(p=null==(d=this.config._internal)?void 0:d.currentDate)?void 0:p.call(d))?c:new Date;if(null!=t){let{value:i,responseHeaders:a}=await eE({url:this.config.url({path:"/images/edits",modelId:this.modelId}),headers:T(this.config.headers(),l),formData:function(e,t={}){let{useArrayBrackets:n=!0}=t,o=new FormData;for(let[t,r]of Object.entries(e))if(null!=r){if(Array.isArray(r)){if(1===r.length){o.append(t,r[0]);continue}let e=n?`${t}[]`:t;for(let t of r)o.append(e,t);continue}o.append(t,r)}return o}({model:this.modelId,prompt:e,image:await Promise.all(t.map(e=>"file"===e.type?new Blob([e.data instanceof Uint8Array?new Blob([e.data],{type:e.mediaType}):new Blob([S(e.data)],{type:e.mediaType})],{type:e.mediaType}):O(e.url))),mask:null!=n?await e8(n):void 0,n:o,size:r,...null!=(m=s.openai)?m:{}}),failedResponseHandler:eF,successfulResponseHandler:eO(e5),abortSignal:u,fetch:this.config.fetch});return{images:i.data.map(e=>e.b64_json),warnings:b,usage:null!=i.usage?{inputTokens:null!=(g=i.usage.input_tokens)?g:void 0,outputTokens:null!=(h=i.usage.output_tokens)?h:void 0,totalTokens:null!=(f=i.usage.total_tokens)?f:void 0}:void 0,response:{timestamp:w,modelId:this.modelId,headers:a},providerMetadata:{openai:{images:i.data.map(e=>{var t,n,o,r,a;return{...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:null!=(t=i.created)?t:void 0,size:null!=(n=i.size)?n:void 0,quality:null!=(o=i.quality)?o:void 0,background:null!=(r=i.background)?r:void 0,outputFormat:null!=(a=i.output_format)?a:void 0}})}}}}let{value:x,responseHeaders:k}=await eA({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:T(this.config.headers(),l),body:{model:this.modelId,prompt:e,n:o,size:r,...null!=(y=s.openai)?y:{},...!e6.has(this.modelId)?{response_format:"b64_json"}:{}},failedResponseHandler:eF,successfulResponseHandler:eO(e5),abortSignal:u,fetch:this.config.fetch});return{images:x.data.map(e=>e.b64_json),warnings:b,usage:null!=x.usage?{inputTokens:null!=(z=x.usage.input_tokens)?z:void 0,outputTokens:null!=(_=x.usage.output_tokens)?_:void 0,totalTokens:null!=(v=x.usage.total_tokens)?v:void 0}:void 0,response:{timestamp:w,modelId:this.modelId,headers:k},providerMetadata:{openai:{images:x.data.map(e=>{var t,n,o,r,i;return{...e.revised_prompt?{revisedPrompt:e.revised_prompt}:{},created:null!=(t=x.created)?t:void 0,size:null!=(n=x.size)?n:void 0,quality:null!=(o=x.quality)?o:void 0,background:null!=(r=x.background)?r:void 0,outputFormat:null!=(i=x.output_format)?i:void 0}})}}}}};async function e8(e){return e?"url"===e.type?O(e.url):new Blob([e.data instanceof Uint8Array?e.data:S(e.data)],{type:e.mediaType}):void 0}var te=ew(()=>ek(eM.z.object({callId:eM.z.string(),operation:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("create_file"),path:eM.z.string(),diff:eM.z.string()}),eM.z.object({type:eM.z.literal("delete_file"),path:eM.z.string()}),eM.z.object({type:eM.z.literal("update_file"),path:eM.z.string(),diff:eM.z.string()})])}))),tt=ew(()=>ek(eM.z.object({status:eM.z.enum(["completed","failed"]),output:eM.z.string().optional()})));ew(()=>ek(eM.z.object({})));var tn=eR({id:"openai.apply_patch",inputSchema:te,outputSchema:tt}),to=ew(()=>ek(eM.z.object({code:eM.z.string().nullish(),containerId:eM.z.string()}))),tr=ew(()=>ek(eM.z.object({outputs:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("logs"),logs:eM.z.string()}),eM.z.object({type:eM.z.literal("image"),url:eM.z.string()})])).nullish()}))),ti=ew(()=>ek(eM.z.object({container:eM.z.union([eM.z.string(),eM.z.object({fileIds:eM.z.array(eM.z.string()).optional()})]).optional()}))),ta=eR({id:"openai.code_interpreter",inputSchema:to,outputSchema:tr}),ts=eM.z.object({key:eM.z.string(),type:eM.z.enum(["eq","ne","gt","gte","lt","lte","in","nin"]),value:eM.z.union([eM.z.string(),eM.z.number(),eM.z.boolean(),eM.z.array(eM.z.string())])}),tl=eM.z.object({type:eM.z.enum(["and","or"]),filters:eM.z.array(eM.z.union([ts,eM.z.lazy(()=>tl)]))}),tu=ew(()=>ek(eM.z.object({vectorStoreIds:eM.z.array(eM.z.string()),maxNumResults:eM.z.number().optional(),ranking:eM.z.object({ranker:eM.z.string().optional(),scoreThreshold:eM.z.number().optional()}).optional(),filters:eM.z.union([ts,tl]).optional()}))),td=ew(()=>ek(eM.z.object({queries:eM.z.array(eM.z.string()),results:eM.z.array(eM.z.object({attributes:eM.z.record(eM.z.string(),eM.z.unknown()),fileId:eM.z.string(),filename:eM.z.string(),score:eM.z.number(),text:eM.z.string()})).nullable()}))),tp=eR({id:"openai.file_search",inputSchema:eM.z.object({}),outputSchema:td}),tc=ew(()=>ek(eM.z.object({background:eM.z.enum(["auto","opaque","transparent"]).optional(),inputFidelity:eM.z.enum(["low","high"]).optional(),inputImageMask:eM.z.object({fileId:eM.z.string().optional(),imageUrl:eM.z.string().optional()}).optional(),model:eM.z.string().optional(),moderation:eM.z.enum(["auto"]).optional(),outputCompression:eM.z.number().int().min(0).max(100).optional(),outputFormat:eM.z.enum(["png","jpeg","webp"]).optional(),partialImages:eM.z.number().int().min(0).max(3).optional(),quality:eM.z.enum(["auto","low","medium","high"]).optional(),size:eM.z.enum(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),tm=eR({id:"openai.image_generation",inputSchema:ew(()=>ek(eM.z.object({}))),outputSchema:ew(()=>ek(eM.z.object({result:eM.z.string()})))}),tg=ew(()=>ek(eM.z.object({action:eM.z.object({type:eM.z.literal("exec"),command:eM.z.array(eM.z.string()),timeoutMs:eM.z.number().optional(),user:eM.z.string().optional(),workingDirectory:eM.z.string().optional(),env:eM.z.record(eM.z.string(),eM.z.string()).optional()})}))),th=ew(()=>ek(eM.z.object({output:eM.z.string()}))),tf=eR({id:"openai.local_shell",inputSchema:tg,outputSchema:th}),ty=ew(()=>ek(eM.z.object({action:eM.z.object({commands:eM.z.array(eM.z.string()),timeoutMs:eM.z.number().optional(),maxOutputLength:eM.z.number().optional()})}))),tz=ew(()=>ek(eM.z.object({output:eM.z.array(eM.z.object({stdout:eM.z.string(),stderr:eM.z.string(),outcome:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("timeout")}),eM.z.object({type:eM.z.literal("exit"),exitCode:eM.z.number()})])}))}))),t_=eR({id:"openai.shell",inputSchema:ty,outputSchema:tz}),tv=ew(()=>ek(eM.z.object({externalWebAccess:eM.z.boolean().optional(),filters:eM.z.object({allowedDomains:eM.z.array(eM.z.string()).optional()}).optional(),searchContextSize:eM.z.enum(["low","medium","high"]).optional(),userLocation:eM.z.object({type:eM.z.literal("approximate"),country:eM.z.string().optional(),city:eM.z.string().optional(),region:eM.z.string().optional(),timezone:eM.z.string().optional()}).optional()}))),tb=eR({id:"openai.web_search",inputSchema:ew(()=>ek(eM.z.object({}))),outputSchema:ew(()=>ek(eM.z.object({action:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("search"),query:eM.z.string().optional()}),eM.z.object({type:eM.z.literal("openPage"),url:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("findInPage"),url:eM.z.string().nullish(),pattern:eM.z.string().nullish()})]),sources:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("url"),url:eM.z.string()}),eM.z.object({type:eM.z.literal("api"),name:eM.z.string()})])).optional()})))}),tw=ew(()=>ek(eM.z.object({searchContextSize:eM.z.enum(["low","medium","high"]).optional(),userLocation:eM.z.object({type:eM.z.literal("approximate"),country:eM.z.string().optional(),city:eM.z.string().optional(),region:eM.z.string().optional(),timezone:eM.z.string().optional()}).optional()}))),tx=eR({id:"openai.web_search_preview",inputSchema:ew(()=>ek(eM.z.object({}))),outputSchema:ew(()=>ek(eM.z.object({action:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("search"),query:eM.z.string().optional()}),eM.z.object({type:eM.z.literal("openPage"),url:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("findInPage"),url:eM.z.string().nullish(),pattern:eM.z.string().nullish()})])})))}),tk=eM.z.lazy(()=>eM.z.union([eM.z.string(),eM.z.number(),eM.z.boolean(),eM.z.null(),eM.z.array(tk),eM.z.record(eM.z.string(),tk)])),tj=ew(()=>ek(eM.z.object({serverLabel:eM.z.string(),allowedTools:eM.z.union([eM.z.array(eM.z.string()),eM.z.object({readOnly:eM.z.boolean().optional(),toolNames:eM.z.array(eM.z.string()).optional()})]).optional(),authorization:eM.z.string().optional(),connectorId:eM.z.string().optional(),headers:eM.z.record(eM.z.string(),eM.z.string()).optional(),requireApproval:eM.z.union([eM.z.enum(["always","never"]),eM.z.object({never:eM.z.object({toolNames:eM.z.array(eM.z.string()).optional()}).optional()})]).optional(),serverDescription:eM.z.string().optional(),serverUrl:eM.z.string().optional()}).refine(e=>null!=e.serverUrl||null!=e.connectorId,"One of serverUrl or connectorId must be provided."))),tI=eR({id:"openai.mcp",inputSchema:ew(()=>ek(eM.z.object({}))),outputSchema:ew(()=>ek(eM.z.object({type:eM.z.literal("call"),serverLabel:eM.z.string(),name:eM.z.string(),arguments:eM.z.string(),output:eM.z.string().nullish(),error:eM.z.union([eM.z.string(),tk]).optional()})))}),tT={applyPatch:tn,codeInterpreter:(e={})=>ta(e),fileSearch:tp,imageGeneration:(e={})=>tm(e),localShell:tf,shell:t_,webSearchPreview:tx,webSearch:(e={})=>tb(e),mcp:e=>tI(e)};function tP(e){var t,n,o,r;if(null==e)return{inputTokens:{total:void 0,noCache:void 0,cacheRead:void 0,cacheWrite:void 0},outputTokens:{total:void 0,text:void 0,reasoning:void 0},raw:void 0};let i=e.input_tokens,a=e.output_tokens,s=null!=(n=null==(t=e.input_tokens_details)?void 0:t.cached_tokens)?n:0,l=null!=(r=null==(o=e.output_tokens_details)?void 0:o.reasoning_tokens)?r:0;return{inputTokens:{total:i,noCache:i-s,cacheRead:s,cacheWrite:void 0},outputTokens:{total:a,text:a-l,reasoning:l},raw:e}}function tC(e,t){return!!t&&t.some(t=>e.startsWith(t))}async function tN({prompt:e,toolNameMapping:t,systemMessageMode:n,providerOptionsName:o,fileIdPrefixes:r,store:i,hasLocalShellTool:a=!1,hasShellTool:s=!1,hasApplyPatchTool:l=!1}){var u,d,p,c,m,g,h,f,y,z,_,v,b;let x=[],k=[],j=new Set;for(let{role:I,content:T}of e)switch(I){case"system":switch(n){case"system":x.push({role:"system",content:T});break;case"developer":x.push({role:"developer",content:T});break;case"remove":k.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${n}`)}break;case"user":x.push({role:"user",content:T.map((e,t)=>{var n,i,a;switch(e.type){case"text":return{type:"input_text",text:e.text};case"file":if(e.mediaType.startsWith("image/")){let t="image/*"===e.mediaType?"image/jpeg":e.mediaType;return{type:"input_image",...e.data instanceof URL?{image_url:e.data.toString()}:"string"==typeof e.data&&tC(e.data,r)?{file_id:e.data}:{image_url:`data:${t};base64,${A(e.data)}`},detail:null==(i=null==(n=e.providerOptions)?void 0:n[o])?void 0:i.imageDetail}}if("application/pdf"===e.mediaType){if(e.data instanceof URL)return{type:"input_file",file_url:e.data.toString()};return{type:"input_file",..."string"==typeof e.data&&tC(e.data,r)?{file_id:e.data}:{filename:null!=(a=e.filename)?a:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${A(e.data)}`}}}throw new w.UnsupportedFunctionalityError({functionality:`file part media type ${e.mediaType}`})}})});break;case"assistant":{let e={};for(let n of T)switch(n.type){case"text":{let e=null==(d=null==(u=n.providerOptions)?void 0:u[o])?void 0:d.itemId;if(i&&null!=e){x.push({type:"item_reference",id:e});break}x.push({role:"assistant",content:[{type:"output_text",text:n.text}],id:e});break}case"tool-call":{let e=null!=(h=null==(c=null==(p=n.providerOptions)?void 0:p[o])?void 0:c.itemId)?h:null==(g=null==(m=n.providerMetadata)?void 0:m[o])?void 0:g.itemId;if(n.providerExecuted){i&&null!=e&&x.push({type:"item_reference",id:e});break}if(i&&null!=e){x.push({type:"item_reference",id:e});break}let r=t.toProviderToolName(n.toolName);if(a&&"local_shell"===r){let t=await ej({value:n.input,schema:tg});x.push({type:"local_shell_call",call_id:n.toolCallId,id:e,action:{type:"exec",command:t.action.command,timeout_ms:t.action.timeoutMs,user:t.action.user,working_directory:t.action.workingDirectory,env:t.action.env}});break}if(s&&"shell"===r){let t=await ej({value:n.input,schema:ty});x.push({type:"shell_call",call_id:n.toolCallId,id:e,status:"completed",action:{commands:t.action.commands,timeout_ms:t.action.timeoutMs,max_output_length:t.action.maxOutputLength}});break}x.push({type:"function_call",call_id:n.toolCallId,name:r,arguments:JSON.stringify(n.input),id:e});break}case"tool-result":if("execution-denied"===n.output.type||"json"===n.output.type&&"object"==typeof n.output.value&&null!=n.output.value&&"type"in n.output.value&&"execution-denied"===n.output.value.type)break;if(i){let e=null!=(z=null==(y=null==(f=n.providerMetadata)?void 0:f[o])?void 0:y.itemId)?z:n.toolCallId;x.push({type:"item_reference",id:e})}else k.push({type:"other",message:`Results for OpenAI tool ${n.toolName} are not sent to the API when store is false`});break;case"reasoning":{let t=await eN({provider:o,providerOptions:n.providerOptions,schema:tS}),r=null==t?void 0:t.itemId;if(null!=r){let o=e[r];if(i)void 0===o&&(x.push({type:"item_reference",id:r}),e[r]={type:"reasoning",id:r,summary:[]});else{let i=[];n.text.length>0?i.push({type:"summary_text",text:n.text}):void 0!==o&&k.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(n)}.`}),void 0===o?(e[r]={type:"reasoning",id:r,encrypted_content:null==t?void 0:t.reasoningEncryptedContent,summary:i},x.push(e[r])):(o.summary.push(...i),(null==t?void 0:t.reasoningEncryptedContent)!=null&&(o.encrypted_content=t.reasoningEncryptedContent))}}else k.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(n)}.`})}}break}case"tool":for(let e of T){let n;if("tool-approval-response"===e.type){if(j.has(e.approvalId))continue;j.add(e.approvalId),i&&x.push({type:"item_reference",id:e.approvalId}),x.push({type:"mcp_approval_response",approval_request_id:e.approvalId,approve:e.approved});continue}let o=e.output;if("execution-denied"===o.type&&(null==(v=null==(_=o.providerOptions)?void 0:_.openai)?void 0:v.approvalId))continue;let r=t.toProviderToolName(e.toolName);if(a&&"local_shell"===r&&"json"===o.type){let t=await ej({value:o.value,schema:th});x.push({type:"local_shell_call_output",call_id:e.toolCallId,output:t.output});continue}if(s&&"shell"===r&&"json"===o.type){let t=await ej({value:o.value,schema:tz});x.push({type:"shell_call_output",call_id:e.toolCallId,output:t.output.map(e=>({stdout:e.stdout,stderr:e.stderr,outcome:"timeout"===e.outcome.type?{type:"timeout"}:{type:"exit",exit_code:e.outcome.exitCode}}))});continue}if(l&&"apply_patch"===e.toolName&&"json"===o.type){let t=await ej({value:o.value,schema:tt});x.push({type:"apply_patch_call_output",call_id:e.toolCallId,status:t.status,output:t.output});continue}switch(o.type){case"text":case"error-text":n=o.value;break;case"execution-denied":n=null!=(b=o.reason)?b:"Tool execution denied.";break;case"json":case"error-json":n=JSON.stringify(o.value);break;case"content":n=o.value.map(e=>{var t;switch(e.type){case"text":return{type:"input_text",text:e.text};case"image-data":return{type:"input_image",image_url:`data:${e.mediaType};base64,${e.data}`};case"file-data":return{type:"input_file",filename:null!=(t=e.filename)?t:"data",file_data:`data:${e.mediaType};base64,${e.data}`};default:return void k.push({type:"other",message:`unsupported tool content part type: ${e.type}`})}}).filter(K)}x.push({type:"function_call_output",call_id:e.toolCallId,output:n})}break;default:throw Error(`Unsupported role: ${I}`)}return{input:x,warnings:k}}var tS=eM.z.object({itemId:eM.z.string().nullish(),reasoningEncryptedContent:eM.z.string().nullish()});function tA({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"other"}}var tE=ew(()=>ek(eM.z.union([eM.z.object({type:eM.z.literal("response.output_text.delta"),item_id:eM.z.string(),delta:eM.z.string(),logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number(),top_logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number()}))})).nullish()}),eM.z.object({type:eM.z.enum(["response.completed","response.incomplete"]),response:eM.z.object({incomplete_details:eM.z.object({reason:eM.z.string()}).nullish(),usage:eM.z.object({input_tokens:eM.z.number(),input_tokens_details:eM.z.object({cached_tokens:eM.z.number().nullish()}).nullish(),output_tokens:eM.z.number(),output_tokens_details:eM.z.object({reasoning_tokens:eM.z.number().nullish()}).nullish()}),service_tier:eM.z.string().nullish()})}),eM.z.object({type:eM.z.literal("response.created"),response:eM.z.object({id:eM.z.string(),created_at:eM.z.number(),model:eM.z.string(),service_tier:eM.z.string().nullish()})}),eM.z.object({type:eM.z.literal("response.output_item.added"),output_index:eM.z.number(),item:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("message"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("reasoning"),id:eM.z.string(),encrypted_content:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("function_call"),id:eM.z.string(),call_id:eM.z.string(),name:eM.z.string(),arguments:eM.z.string()}),eM.z.object({type:eM.z.literal("web_search_call"),id:eM.z.string(),status:eM.z.string()}),eM.z.object({type:eM.z.literal("computer_call"),id:eM.z.string(),status:eM.z.string()}),eM.z.object({type:eM.z.literal("file_search_call"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("image_generation_call"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("code_interpreter_call"),id:eM.z.string(),container_id:eM.z.string(),code:eM.z.string().nullable(),outputs:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("logs"),logs:eM.z.string()}),eM.z.object({type:eM.z.literal("image"),url:eM.z.string()})])).nullable(),status:eM.z.string()}),eM.z.object({type:eM.z.literal("mcp_call"),id:eM.z.string(),status:eM.z.string(),approval_request_id:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("mcp_list_tools"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("mcp_approval_request"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("apply_patch_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed"]),operation:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("create_file"),path:eM.z.string(),diff:eM.z.string()}),eM.z.object({type:eM.z.literal("delete_file"),path:eM.z.string()}),eM.z.object({type:eM.z.literal("update_file"),path:eM.z.string(),diff:eM.z.string()})])}),eM.z.object({type:eM.z.literal("shell_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed","incomplete"]),action:eM.z.object({commands:eM.z.array(eM.z.string())})})])}),eM.z.object({type:eM.z.literal("response.output_item.done"),output_index:eM.z.number(),item:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("message"),id:eM.z.string()}),eM.z.object({type:eM.z.literal("reasoning"),id:eM.z.string(),encrypted_content:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("function_call"),id:eM.z.string(),call_id:eM.z.string(),name:eM.z.string(),arguments:eM.z.string(),status:eM.z.literal("completed")}),eM.z.object({type:eM.z.literal("code_interpreter_call"),id:eM.z.string(),code:eM.z.string().nullable(),container_id:eM.z.string(),outputs:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("logs"),logs:eM.z.string()}),eM.z.object({type:eM.z.literal("image"),url:eM.z.string()})])).nullable()}),eM.z.object({type:eM.z.literal("image_generation_call"),id:eM.z.string(),result:eM.z.string()}),eM.z.object({type:eM.z.literal("web_search_call"),id:eM.z.string(),status:eM.z.string(),action:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("search"),query:eM.z.string().nullish(),sources:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("url"),url:eM.z.string()}),eM.z.object({type:eM.z.literal("api"),name:eM.z.string()})])).nullish()}),eM.z.object({type:eM.z.literal("open_page"),url:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("find_in_page"),url:eM.z.string().nullish(),pattern:eM.z.string().nullish()})])}),eM.z.object({type:eM.z.literal("file_search_call"),id:eM.z.string(),queries:eM.z.array(eM.z.string()),results:eM.z.array(eM.z.object({attributes:eM.z.record(eM.z.string(),eM.z.union([eM.z.string(),eM.z.number(),eM.z.boolean()])),file_id:eM.z.string(),filename:eM.z.string(),score:eM.z.number(),text:eM.z.string()})).nullish()}),eM.z.object({type:eM.z.literal("local_shell_call"),id:eM.z.string(),call_id:eM.z.string(),action:eM.z.object({type:eM.z.literal("exec"),command:eM.z.array(eM.z.string()),timeout_ms:eM.z.number().optional(),user:eM.z.string().optional(),working_directory:eM.z.string().optional(),env:eM.z.record(eM.z.string(),eM.z.string()).optional()})}),eM.z.object({type:eM.z.literal("computer_call"),id:eM.z.string(),status:eM.z.literal("completed")}),eM.z.object({type:eM.z.literal("mcp_call"),id:eM.z.string(),status:eM.z.string(),arguments:eM.z.string(),name:eM.z.string(),server_label:eM.z.string(),output:eM.z.string().nullish(),error:eM.z.union([eM.z.string(),eM.z.object({type:eM.z.string().optional(),code:eM.z.union([eM.z.number(),eM.z.string()]).optional(),message:eM.z.string().optional()}).loose()]).nullish(),approval_request_id:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("mcp_list_tools"),id:eM.z.string(),server_label:eM.z.string(),tools:eM.z.array(eM.z.object({name:eM.z.string(),description:eM.z.string().optional(),input_schema:eM.z.any(),annotations:eM.z.record(eM.z.string(),eM.z.unknown()).optional()})),error:eM.z.union([eM.z.string(),eM.z.object({type:eM.z.string().optional(),code:eM.z.union([eM.z.number(),eM.z.string()]).optional(),message:eM.z.string().optional()}).loose()]).optional()}),eM.z.object({type:eM.z.literal("mcp_approval_request"),id:eM.z.string(),server_label:eM.z.string(),name:eM.z.string(),arguments:eM.z.string(),approval_request_id:eM.z.string().optional()}),eM.z.object({type:eM.z.literal("apply_patch_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed"]),operation:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("create_file"),path:eM.z.string(),diff:eM.z.string()}),eM.z.object({type:eM.z.literal("delete_file"),path:eM.z.string()}),eM.z.object({type:eM.z.literal("update_file"),path:eM.z.string(),diff:eM.z.string()})])}),eM.z.object({type:eM.z.literal("shell_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed","incomplete"]),action:eM.z.object({commands:eM.z.array(eM.z.string())})})])}),eM.z.object({type:eM.z.literal("response.function_call_arguments.delta"),item_id:eM.z.string(),output_index:eM.z.number(),delta:eM.z.string()}),eM.z.object({type:eM.z.literal("response.image_generation_call.partial_image"),item_id:eM.z.string(),output_index:eM.z.number(),partial_image_b64:eM.z.string()}),eM.z.object({type:eM.z.literal("response.code_interpreter_call_code.delta"),item_id:eM.z.string(),output_index:eM.z.number(),delta:eM.z.string()}),eM.z.object({type:eM.z.literal("response.code_interpreter_call_code.done"),item_id:eM.z.string(),output_index:eM.z.number(),code:eM.z.string()}),eM.z.object({type:eM.z.literal("response.output_text.annotation.added"),annotation:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("url_citation"),start_index:eM.z.number(),end_index:eM.z.number(),url:eM.z.string(),title:eM.z.string()}),eM.z.object({type:eM.z.literal("file_citation"),file_id:eM.z.string(),filename:eM.z.string().nullish(),index:eM.z.number().nullish(),start_index:eM.z.number().nullish(),end_index:eM.z.number().nullish(),quote:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("container_file_citation"),container_id:eM.z.string(),file_id:eM.z.string(),filename:eM.z.string().nullish(),start_index:eM.z.number().nullish(),end_index:eM.z.number().nullish(),index:eM.z.number().nullish()}),eM.z.object({type:eM.z.literal("file_path"),file_id:eM.z.string(),index:eM.z.number().nullish()})])}),eM.z.object({type:eM.z.literal("response.reasoning_summary_part.added"),item_id:eM.z.string(),summary_index:eM.z.number()}),eM.z.object({type:eM.z.literal("response.reasoning_summary_text.delta"),item_id:eM.z.string(),summary_index:eM.z.number(),delta:eM.z.string()}),eM.z.object({type:eM.z.literal("response.reasoning_summary_part.done"),item_id:eM.z.string(),summary_index:eM.z.number()}),eM.z.object({type:eM.z.literal("response.apply_patch_call_operation_diff.delta"),item_id:eM.z.string(),output_index:eM.z.number(),delta:eM.z.string(),obfuscation:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("response.apply_patch_call_operation_diff.done"),item_id:eM.z.string(),output_index:eM.z.number(),diff:eM.z.string()}),eM.z.object({type:eM.z.literal("error"),sequence_number:eM.z.number(),error:eM.z.object({type:eM.z.string(),code:eM.z.string(),message:eM.z.string(),param:eM.z.string().nullish()})}),eM.z.object({type:eM.z.string()}).loose().transform(e=>({type:"unknown_chunk",message:e.type}))]))),tq=ew(()=>ek(eM.z.object({id:eM.z.string().optional(),created_at:eM.z.number().optional(),error:eM.z.object({message:eM.z.string(),type:eM.z.string(),param:eM.z.string().nullish(),code:eM.z.string()}).nullish(),model:eM.z.string().optional(),output:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("message"),role:eM.z.literal("assistant"),id:eM.z.string(),content:eM.z.array(eM.z.object({type:eM.z.literal("output_text"),text:eM.z.string(),logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number(),top_logprobs:eM.z.array(eM.z.object({token:eM.z.string(),logprob:eM.z.number()}))})).nullish(),annotations:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("url_citation"),start_index:eM.z.number(),end_index:eM.z.number(),url:eM.z.string(),title:eM.z.string()}),eM.z.object({type:eM.z.literal("file_citation"),file_id:eM.z.string(),filename:eM.z.string().nullish(),index:eM.z.number().nullish(),start_index:eM.z.number().nullish(),end_index:eM.z.number().nullish(),quote:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("container_file_citation"),container_id:eM.z.string(),file_id:eM.z.string(),filename:eM.z.string().nullish(),start_index:eM.z.number().nullish(),end_index:eM.z.number().nullish(),index:eM.z.number().nullish()}),eM.z.object({type:eM.z.literal("file_path"),file_id:eM.z.string(),index:eM.z.number().nullish()})]))}))}),eM.z.object({type:eM.z.literal("web_search_call"),id:eM.z.string(),status:eM.z.string(),action:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("search"),query:eM.z.string().nullish(),sources:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("url"),url:eM.z.string()}),eM.z.object({type:eM.z.literal("api"),name:eM.z.string()})])).nullish()}),eM.z.object({type:eM.z.literal("open_page"),url:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("find_in_page"),url:eM.z.string().nullish(),pattern:eM.z.string().nullish()})])}),eM.z.object({type:eM.z.literal("file_search_call"),id:eM.z.string(),queries:eM.z.array(eM.z.string()),results:eM.z.array(eM.z.object({attributes:eM.z.record(eM.z.string(),eM.z.union([eM.z.string(),eM.z.number(),eM.z.boolean()])),file_id:eM.z.string(),filename:eM.z.string(),score:eM.z.number(),text:eM.z.string()})).nullish()}),eM.z.object({type:eM.z.literal("code_interpreter_call"),id:eM.z.string(),code:eM.z.string().nullable(),container_id:eM.z.string(),outputs:eM.z.array(eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("logs"),logs:eM.z.string()}),eM.z.object({type:eM.z.literal("image"),url:eM.z.string()})])).nullable()}),eM.z.object({type:eM.z.literal("image_generation_call"),id:eM.z.string(),result:eM.z.string()}),eM.z.object({type:eM.z.literal("local_shell_call"),id:eM.z.string(),call_id:eM.z.string(),action:eM.z.object({type:eM.z.literal("exec"),command:eM.z.array(eM.z.string()),timeout_ms:eM.z.number().optional(),user:eM.z.string().optional(),working_directory:eM.z.string().optional(),env:eM.z.record(eM.z.string(),eM.z.string()).optional()})}),eM.z.object({type:eM.z.literal("function_call"),call_id:eM.z.string(),name:eM.z.string(),arguments:eM.z.string(),id:eM.z.string()}),eM.z.object({type:eM.z.literal("computer_call"),id:eM.z.string(),status:eM.z.string().optional()}),eM.z.object({type:eM.z.literal("reasoning"),id:eM.z.string(),encrypted_content:eM.z.string().nullish(),summary:eM.z.array(eM.z.object({type:eM.z.literal("summary_text"),text:eM.z.string()}))}),eM.z.object({type:eM.z.literal("mcp_call"),id:eM.z.string(),status:eM.z.string(),arguments:eM.z.string(),name:eM.z.string(),server_label:eM.z.string(),output:eM.z.string().nullish(),error:eM.z.union([eM.z.string(),eM.z.object({type:eM.z.string().optional(),code:eM.z.union([eM.z.number(),eM.z.string()]).optional(),message:eM.z.string().optional()}).loose()]).nullish(),approval_request_id:eM.z.string().nullish()}),eM.z.object({type:eM.z.literal("mcp_list_tools"),id:eM.z.string(),server_label:eM.z.string(),tools:eM.z.array(eM.z.object({name:eM.z.string(),description:eM.z.string().optional(),input_schema:eM.z.any(),annotations:eM.z.record(eM.z.string(),eM.z.unknown()).optional()})),error:eM.z.union([eM.z.string(),eM.z.object({type:eM.z.string().optional(),code:eM.z.union([eM.z.number(),eM.z.string()]).optional(),message:eM.z.string().optional()}).loose()]).optional()}),eM.z.object({type:eM.z.literal("mcp_approval_request"),id:eM.z.string(),server_label:eM.z.string(),name:eM.z.string(),arguments:eM.z.string(),approval_request_id:eM.z.string().optional()}),eM.z.object({type:eM.z.literal("apply_patch_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed"]),operation:eM.z.discriminatedUnion("type",[eM.z.object({type:eM.z.literal("create_file"),path:eM.z.string(),diff:eM.z.string()}),eM.z.object({type:eM.z.literal("delete_file"),path:eM.z.string()}),eM.z.object({type:eM.z.literal("update_file"),path:eM.z.string(),diff:eM.z.string()})])}),eM.z.object({type:eM.z.literal("shell_call"),id:eM.z.string(),call_id:eM.z.string(),status:eM.z.enum(["in_progress","completed","incomplete"]),action:eM.z.object({commands:eM.z.array(eM.z.string())})})])).optional(),service_tier:eM.z.string().nullish(),incomplete_details:eM.z.object({reason:eM.z.string()}).nullish(),usage:eM.z.object({input_tokens:eM.z.number(),input_tokens_details:eM.z.object({cached_tokens:eM.z.number().nullish()}).nullish(),output_tokens:eM.z.number(),output_tokens_details:eM.z.object({reasoning_tokens:eM.z.number().nullish()}).nullish()}).optional()}))),tR=ew(()=>ek(eM.z.object({conversation:eM.z.string().nullish(),include:eM.z.array(eM.z.enum(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:eM.z.string().nullish(),logprobs:eM.z.union([eM.z.boolean(),eM.z.number().min(1).max(20)]).optional(),maxToolCalls:eM.z.number().nullish(),metadata:eM.z.any().nullish(),parallelToolCalls:eM.z.boolean().nullish(),previousResponseId:eM.z.string().nullish(),promptCacheKey:eM.z.string().nullish(),promptCacheRetention:eM.z.enum(["in_memory","24h"]).nullish(),reasoningEffort:eM.z.string().nullish(),reasoningSummary:eM.z.string().nullish(),safetyIdentifier:eM.z.string().nullish(),serviceTier:eM.z.enum(["auto","flex","priority","default"]).nullish(),store:eM.z.boolean().nullish(),strictJsonSchema:eM.z.boolean().nullish(),textVerbosity:eM.z.enum(["low","medium","high"]).nullish(),truncation:eM.z.enum(["auto","disabled"]).nullish(),user:eM.z.string().nullish(),systemMessageMode:eM.z.enum(["system","developer","remove"]).optional(),forceReasoning:eM.z.boolean().optional()})));async function t$({tools:e,toolChoice:t}){e=(null==e?void 0:e.length)?e:void 0;let n=[];if(null==e)return{tools:void 0,toolChoice:void 0,toolWarnings:n};let o=[];for(let t of e)switch(t.type){case"function":o.push({type:"function",name:t.name,description:t.description,parameters:t.inputSchema,...null!=t.strict?{strict:t.strict}:{}});break;case"provider":switch(t.id){case"openai.file_search":{let e=await ej({value:t.args,schema:tu});o.push({type:"file_search",vector_store_ids:e.vectorStoreIds,max_num_results:e.maxNumResults,ranking_options:e.ranking?{ranker:e.ranking.ranker,score_threshold:e.ranking.scoreThreshold}:void 0,filters:e.filters});break}case"openai.local_shell":o.push({type:"local_shell"});break;case"openai.shell":o.push({type:"shell"});break;case"openai.apply_patch":o.push({type:"apply_patch"});break;case"openai.web_search_preview":{let e=await ej({value:t.args,schema:tw});o.push({type:"web_search_preview",search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.web_search":{let e=await ej({value:t.args,schema:tv});o.push({type:"web_search",filters:null!=e.filters?{allowed_domains:e.filters.allowedDomains}:void 0,external_web_access:e.externalWebAccess,search_context_size:e.searchContextSize,user_location:e.userLocation});break}case"openai.code_interpreter":{let e=await ej({value:t.args,schema:ti});o.push({type:"code_interpreter",container:null==e.container?{type:"auto",file_ids:void 0}:"string"==typeof e.container?e.container:{type:"auto",file_ids:e.container.fileIds}});break}case"openai.image_generation":{let e=await ej({value:t.args,schema:tc});o.push({type:"image_generation",background:e.background,input_fidelity:e.inputFidelity,input_image_mask:e.inputImageMask?{file_id:e.inputImageMask.fileId,image_url:e.inputImageMask.imageUrl}:void 0,model:e.model,moderation:e.moderation,partial_images:e.partialImages,quality:e.quality,output_compression:e.outputCompression,output_format:e.outputFormat,size:e.size});break}case"openai.mcp":{let e=await ej({value:t.args,schema:tj}),n=e=>({tool_names:e.toolNames}),r=e.requireApproval,i=null==r?void 0:"string"==typeof r?r:null!=r.never?{never:n(r.never)}:void 0;o.push({type:"mcp",server_label:e.serverLabel,allowed_tools:Array.isArray(e.allowedTools)?e.allowedTools:e.allowedTools?{read_only:e.allowedTools.readOnly,tool_names:e.allowedTools.toolNames}:void 0,authorization:e.authorization,connector_id:e.connectorId,headers:e.headers,require_approval:null!=i?i:"never",server_description:e.serverDescription,server_url:e.serverUrl})}}break;default:n.push({type:"unsupported",feature:`function tool ${t}`})}if(null==t)return{tools:o,toolChoice:void 0,toolWarnings:n};let r=t.type;switch(r){case"auto":case"none":case"required":return{tools:o,toolChoice:r,toolWarnings:n};case"tool":return{tools:o,toolChoice:"code_interpreter"===t.toolName||"file_search"===t.toolName||"image_generation"===t.toolName||"web_search_preview"===t.toolName||"web_search"===t.toolName||"mcp"===t.toolName||"apply_patch"===t.toolName?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:n};default:throw new w.UnsupportedFunctionalityError({functionality:`tool choice type: ${r}`})}}function tO(e){var t,n;let o={};for(let r of e)if("assistant"===r.role)for(let e of r.content){if("tool-call"!==e.type)continue;let r=null==(n=null==(t=e.providerOptions)?void 0:t.openai)?void 0:n.approvalRequestId;null!=r&&(o[r]=e.toolCallId)}return o}var tM=class{constructor(e,t){this.specificationVersion="v3",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:n,topP:o,topK:r,presencePenalty:i,frequencyPenalty:a,seed:s,prompt:l,providerOptions:u,tools:d,toolChoice:p,responseFormat:c}){var m,g,h,f,y,z;let _=[],v=eU(this.modelId);null!=r&&_.push({type:"unsupported",feature:"topK"}),null!=s&&_.push({type:"unsupported",feature:"seed"}),null!=i&&_.push({type:"unsupported",feature:"presencePenalty"}),null!=a&&_.push({type:"unsupported",feature:"frequencyPenalty"}),null!=n&&_.push({type:"unsupported",feature:"stopSequences"});let b=this.config.provider.includes("azure")?"azure":"openai",w=await eN({provider:b,providerOptions:u,schema:tR});null==w&&"openai"!==b&&(w=await eN({provider:"openai",providerOptions:u,schema:tR}));let x=null!=(m=null==w?void 0:w.forceReasoning)?m:v.isReasoningModel;(null==w?void 0:w.conversation)&&(null==w?void 0:w.previousResponseId)&&_.push({type:"unsupported",feature:"conversation",details:"conversation and previousResponseId cannot be used together"});let k=function({tools:e=[],providerToolNames:t}){let n={},o={};for(let r of e)if("provider"===r.type&&r.id in t){let e=t[r.id];n[r.name]=e,o[e]=r.name}return{toProviderToolName:e=>{var t;return null!=(t=n[e])?t:e},toCustomToolName:e=>{var t;return null!=(t=o[e])?t:e}}}({tools:d,providerToolNames:{"openai.code_interpreter":"code_interpreter","openai.file_search":"file_search","openai.image_generation":"image_generation","openai.local_shell":"local_shell","openai.shell":"shell","openai.web_search":"web_search","openai.web_search_preview":"web_search_preview","openai.mcp":"mcp","openai.apply_patch":"apply_patch"}}),{input:j,warnings:I}=await tN({prompt:l,toolNameMapping:k,systemMessageMode:null!=(g=null==w?void 0:w.systemMessageMode)?g:x?"developer":v.systemMessageMode,providerOptionsName:b,fileIdPrefixes:this.config.fileIdPrefixes,store:null==(h=null==w?void 0:w.store)||h,hasLocalShellTool:N("openai.local_shell"),hasShellTool:N("openai.shell"),hasApplyPatchTool:N("openai.apply_patch")});_.push(...I);let T=null==(f=null==w?void 0:w.strictJsonSchema)||f,P=null==w?void 0:w.include;function C(e){null==P?P=[e]:P.includes(e)||(P=[...P,e])}function N(e){return(null==d?void 0:d.find(t=>"provider"===t.type&&t.id===e))!=null}let S="number"==typeof(null==w?void 0:w.logprobs)?null==w?void 0:w.logprobs:(null==w?void 0:w.logprobs)===!0?20:void 0;S&&C("message.output_text.logprobs");let A=null==(y=null==d?void 0:d.find(e=>"provider"===e.type&&("openai.web_search"===e.id||"openai.web_search_preview"===e.id)))?void 0:y.name;A&&C("web_search_call.action.sources"),N("openai.code_interpreter")&&C("code_interpreter_call.outputs");let E=null==w?void 0:w.store;!1===E&&x&&C("reasoning.encrypted_content");let q={model:this.modelId,input:j,temperature:t,top_p:o,max_output_tokens:e,...((null==c?void 0:c.type)==="json"||(null==w?void 0:w.textVerbosity))&&{text:{...(null==c?void 0:c.type)==="json"&&{format:null!=c.schema?{type:"json_schema",strict:T,name:null!=(z=c.name)?z:"response",description:c.description,schema:c.schema}:{type:"json_object"}},...(null==w?void 0:w.textVerbosity)&&{verbosity:w.textVerbosity}}},conversation:null==w?void 0:w.conversation,max_tool_calls:null==w?void 0:w.maxToolCalls,metadata:null==w?void 0:w.metadata,parallel_tool_calls:null==w?void 0:w.parallelToolCalls,previous_response_id:null==w?void 0:w.previousResponseId,store:E,user:null==w?void 0:w.user,instructions:null==w?void 0:w.instructions,service_tier:null==w?void 0:w.serviceTier,include:P,prompt_cache_key:null==w?void 0:w.promptCacheKey,prompt_cache_retention:null==w?void 0:w.promptCacheRetention,safety_identifier:null==w?void 0:w.safetyIdentifier,top_logprobs:S,truncation:null==w?void 0:w.truncation,...x&&((null==w?void 0:w.reasoningEffort)!=null||(null==w?void 0:w.reasoningSummary)!=null)&&{reasoning:{...(null==w?void 0:w.reasoningEffort)!=null&&{effort:w.reasoningEffort},...(null==w?void 0:w.reasoningSummary)!=null&&{summary:w.reasoningSummary}}}};x?(null==w?void 0:w.reasoningEffort)==="none"&&v.supportsNonReasoningParameters||(null!=q.temperature&&(q.temperature=void 0,_.push({type:"unsupported",feature:"temperature",details:"temperature is not supported for reasoning models"})),null!=q.top_p&&(q.top_p=void 0,_.push({type:"unsupported",feature:"topP",details:"topP is not supported for reasoning models"}))):((null==w?void 0:w.reasoningEffort)!=null&&_.push({type:"unsupported",feature:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),(null==w?void 0:w.reasoningSummary)!=null&&_.push({type:"unsupported",feature:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),(null==w?void 0:w.serviceTier)!=="flex"||v.supportsFlexProcessing||(_.push({type:"unsupported",feature:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete q.service_tier),(null==w?void 0:w.serviceTier)!=="priority"||v.supportsPriorityProcessing||(_.push({type:"unsupported",feature:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete q.service_tier);let{tools:R,toolChoice:$,toolWarnings:O}=await t$({tools:d,toolChoice:p});return{webSearchToolName:A,args:{...q,tools:R,tool_choice:$},warnings:[..._,...O],store:E,toolNameMapping:k,providerOptionsName:b}}async doGenerate(e){var t,n,o,r,i,a,s,l,u,d,p,c,m,g,h,f,y,z,_,v,b,x,k,j,I,P,C,N,S,A,E;let{args:q,warnings:R,webSearchToolName:$,toolNameMapping:O,providerOptionsName:Z}=await this.getArgs(e),F=this.config.url({path:"/responses",modelId:this.modelId}),U=tO(e.prompt),{responseHeaders:K,value:L,rawValue:D}=await eA({url:F,headers:T(this.config.headers(),e.headers),body:q,failedResponseHandler:eF,successfulResponseHandler:eO(tq),abortSignal:e.abortSignal,fetch:this.config.fetch});if(L.error)throw new w.APICallError({message:L.error.message,url:F,requestBodyValues:q,statusCode:400,responseHeaders:K,responseBody:D,isRetryable:!1});let V=[],H=[],B=!1;for(let w of L.output)switch(w.type){case"reasoning":for(let e of(0===w.summary.length&&w.summary.push({type:"summary_text",text:""}),w.summary))V.push({type:"reasoning",text:e.text,providerMetadata:{[Z]:{itemId:w.id,reasoningEncryptedContent:null!=(t=w.encrypted_content)?t:null}}});break;case"image_generation_call":V.push({type:"tool-call",toolCallId:w.id,toolName:O.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:w.id,toolName:O.toCustomToolName("image_generation"),result:{result:w.result}});break;case"local_shell_call":V.push({type:"tool-call",toolCallId:w.call_id,toolName:O.toCustomToolName("local_shell"),input:JSON.stringify({action:w.action}),providerMetadata:{[Z]:{itemId:w.id}}});break;case"shell_call":V.push({type:"tool-call",toolCallId:w.call_id,toolName:O.toCustomToolName("shell"),input:JSON.stringify({action:{commands:w.action.commands}}),providerMetadata:{[Z]:{itemId:w.id}}});break;case"message":for(let t of w.content){(null==(o=null==(n=e.providerOptions)?void 0:n[Z])?void 0:o.logprobs)&&t.logprobs&&H.push(t.logprobs);let x={itemId:w.id,...t.annotations.length>0&&{annotations:t.annotations}};for(let e of(V.push({type:"text",text:t.text,providerMetadata:{[Z]:x}}),t.annotations))"url_citation"===e.type?V.push({type:"source",sourceType:"url",id:null!=(a=null==(i=(r=this.config).generateId)?void 0:i.call(r))?a:M(),url:e.url,title:e.title}):"file_citation"===e.type?V.push({type:"source",sourceType:"document",id:null!=(u=null==(l=(s=this.config).generateId)?void 0:l.call(s))?u:M(),mediaType:"text/plain",title:null!=(p=null!=(d=e.quote)?d:e.filename)?p:"Document",filename:null!=(c=e.filename)?c:e.file_id,...e.file_id?{providerMetadata:{[Z]:{fileId:e.file_id}}}:{}}):"container_file_citation"===e.type?V.push({type:"source",sourceType:"document",id:null!=(h=null==(g=(m=this.config).generateId)?void 0:g.call(m))?h:M(),mediaType:"text/plain",title:null!=(y=null!=(f=e.filename)?f:e.file_id)?y:"Document",filename:null!=(z=e.filename)?z:e.file_id,providerMetadata:{[Z]:{fileId:e.file_id,containerId:e.container_id,...null!=e.index?{index:e.index}:{}}}}):"file_path"===e.type&&V.push({type:"source",sourceType:"document",id:null!=(b=null==(v=(_=this.config).generateId)?void 0:v.call(_))?b:M(),mediaType:"application/octet-stream",title:e.file_id,filename:e.file_id,providerMetadata:{[Z]:{fileId:e.file_id,...null!=e.index?{index:e.index}:{}}}})}break;case"function_call":B=!0,V.push({type:"tool-call",toolCallId:w.call_id,toolName:w.name,input:w.arguments,providerMetadata:{[Z]:{itemId:w.id}}});break;case"web_search_call":V.push({type:"tool-call",toolCallId:w.id,toolName:O.toCustomToolName(null!=$?$:"web_search"),input:JSON.stringify({}),providerExecuted:!0}),V.push({type:"tool-result",toolCallId:w.id,toolName:O.toCustomToolName(null!=$?$:"web_search"),result:tF(w.action)});break;case"mcp_call":{let e=null!=w.approval_request_id&&null!=(x=U[w.approval_request_id])?x:w.id,t=`mcp.${w.name}`;V.push({type:"tool-call",toolCallId:e,toolName:t,input:w.arguments,providerExecuted:!0,dynamic:!0}),V.push({type:"tool-result",toolCallId:e,toolName:t,result:{type:"call",serverLabel:w.server_label,name:w.name,arguments:w.arguments,...null!=w.output?{output:w.output}:{},...null!=w.error?{error:w.error}:{}},providerMetadata:{[Z]:{itemId:w.id}}});break}case"mcp_list_tools":break;case"mcp_approval_request":{let e=null!=(k=w.approval_request_id)?k:w.id,t=null!=(P=null==(I=(j=this.config).generateId)?void 0:I.call(j))?P:M(),n=`mcp.${w.name}`;V.push({type:"tool-call",toolCallId:t,toolName:n,input:w.arguments,providerExecuted:!0,dynamic:!0}),V.push({type:"tool-approval-request",approvalId:e,toolCallId:t});break}case"computer_call":V.push({type:"tool-call",toolCallId:w.id,toolName:O.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:w.id,toolName:O.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:w.status||"completed"}});break;case"file_search_call":V.push({type:"tool-call",toolCallId:w.id,toolName:O.toCustomToolName("file_search"),input:"{}",providerExecuted:!0}),V.push({type:"tool-result",toolCallId:w.id,toolName:O.toCustomToolName("file_search"),result:{queries:w.queries,results:null!=(N=null==(C=w.results)?void 0:C.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?N:null}});break;case"code_interpreter_call":V.push({type:"tool-call",toolCallId:w.id,toolName:O.toCustomToolName("code_interpreter"),input:JSON.stringify({code:w.code,containerId:w.container_id}),providerExecuted:!0}),V.push({type:"tool-result",toolCallId:w.id,toolName:O.toCustomToolName("code_interpreter"),result:{outputs:w.outputs}});break;case"apply_patch_call":V.push({type:"tool-call",toolCallId:w.call_id,toolName:O.toCustomToolName("apply_patch"),input:JSON.stringify({callId:w.call_id,operation:w.operation}),providerMetadata:{[Z]:{itemId:w.id}}})}let W={[Z]:{responseId:L.id}};H.length>0&&(W[Z].logprobs=H),"string"==typeof L.service_tier&&(W[Z].serviceTier=L.service_tier);let G=L.usage;return{content:V,finishReason:{unified:tA({finishReason:null==(S=L.incomplete_details)?void 0:S.reason,hasFunctionCall:B}),raw:null!=(E=null==(A=L.incomplete_details)?void 0:A.reason)?E:void 0},usage:tP(G),request:{body:q},response:{id:L.id,timestamp:new Date(1e3*L.created_at),modelId:L.model,headers:K,body:D},providerMetadata:W,warnings:R}}async doStream(e){let t,n,{args:o,warnings:r,webSearchToolName:i,toolNameMapping:a,store:s,providerOptionsName:l}=await this.getArgs(e),{responseHeaders:u,value:d}=await eA({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:{...o,stream:!0},failedResponseHandler:eF,successfulResponseHandler:e$(tE),abortSignal:e.abortSignal,fetch:this.config.fetch}),p=this,c=tO(e.prompt),m=new Map,g={unified:"other",raw:void 0},h=[],f=null,y={},z=[],_=!1,v={};return{stream:d.pipeThrough(new TransformStream({start(e){e.enqueue({type:"stream-start",warnings:r})},transform(o,r){var u,d,b,w,x,k,j,I,T,P,C,N,S,A,E,q,R,$,O,Z,F,U,K,L,D,V,H,B,W,G,J,Y,X,Q,ee,et,en;if(e.includeRawChunks&&r.enqueue({type:"raw",rawValue:o.rawValue}),!o.success){g={unified:"error",raw:void 0},r.enqueue({type:"error",error:o.error});return}let eo=o.value;if(tZ(eo))if("function_call"===eo.item.type)y[eo.output_index]={toolName:eo.item.name,toolCallId:eo.item.call_id},r.enqueue({type:"tool-input-start",id:eo.item.call_id,toolName:eo.item.name});else if("web_search_call"===eo.item.type)y[eo.output_index]={toolName:a.toCustomToolName(null!=i?i:"web_search"),toolCallId:eo.item.id},r.enqueue({type:"tool-input-start",id:eo.item.id,toolName:a.toCustomToolName(null!=i?i:"web_search"),providerExecuted:!0}),r.enqueue({type:"tool-input-end",id:eo.item.id}),r.enqueue({type:"tool-call",toolCallId:eo.item.id,toolName:a.toCustomToolName(null!=i?i:"web_search"),input:JSON.stringify({}),providerExecuted:!0});else if("computer_call"===eo.item.type)y[eo.output_index]={toolName:a.toCustomToolName("computer_use"),toolCallId:eo.item.id},r.enqueue({type:"tool-input-start",id:eo.item.id,toolName:a.toCustomToolName("computer_use"),providerExecuted:!0});else if("code_interpreter_call"===eo.item.type)y[eo.output_index]={toolName:a.toCustomToolName("code_interpreter"),toolCallId:eo.item.id,codeInterpreter:{containerId:eo.item.container_id}},r.enqueue({type:"tool-input-start",id:eo.item.id,toolName:a.toCustomToolName("code_interpreter"),providerExecuted:!0}),r.enqueue({type:"tool-input-delta",id:eo.item.id,delta:`{"containerId":"${eo.item.container_id}","code":"`});else if("file_search_call"===eo.item.type)r.enqueue({type:"tool-call",toolCallId:eo.item.id,toolName:a.toCustomToolName("file_search"),input:"{}",providerExecuted:!0});else if("image_generation_call"===eo.item.type)r.enqueue({type:"tool-call",toolCallId:eo.item.id,toolName:a.toCustomToolName("image_generation"),input:"{}",providerExecuted:!0});else if("mcp_call"===eo.item.type||"mcp_list_tools"===eo.item.type||"mcp_approval_request"===eo.item.type);else if("apply_patch_call"===eo.item.type){let{call_id:e,operation:t}=eo.item;if(y[eo.output_index]={toolName:a.toCustomToolName("apply_patch"),toolCallId:e,applyPatch:{hasDiff:"delete_file"===t.type,endEmitted:"delete_file"===t.type}},r.enqueue({type:"tool-input-start",id:e,toolName:a.toCustomToolName("apply_patch")}),"delete_file"===t.type){let n=JSON.stringify({callId:e,operation:t});r.enqueue({type:"tool-input-delta",id:e,delta:n}),r.enqueue({type:"tool-input-end",id:e})}else r.enqueue({type:"tool-input-delta",id:e,delta:`{"callId":"${tU(e)}","operation":{"type":"${tU(t.type)}","path":"${tU(t.path)}","diff":"`})}else"shell_call"===eo.item.type?y[eo.output_index]={toolName:a.toCustomToolName("shell"),toolCallId:eo.item.call_id}:"message"===eo.item.type?(z.splice(0,z.length),r.enqueue({type:"text-start",id:eo.item.id,providerMetadata:{[l]:{itemId:eo.item.id}}})):tZ(eo)&&"reasoning"===eo.item.type&&(v[eo.item.id]={encryptedContent:eo.item.encrypted_content,summaryParts:{0:"active"}},r.enqueue({type:"reasoning-start",id:`${eo.item.id}:0`,providerMetadata:{[l]:{itemId:eo.item.id,reasoningEncryptedContent:null!=(u=eo.item.encrypted_content)?u:null}}}));else if("response.output_item.done"===eo.type){if("message"===eo.item.type)r.enqueue({type:"text-end",id:eo.item.id,providerMetadata:{[l]:{itemId:eo.item.id,...z.length>0&&{annotations:z}}}});else if("function_call"===eo.item.type)y[eo.output_index]=void 0,_=!0,r.enqueue({type:"tool-input-end",id:eo.item.call_id}),r.enqueue({type:"tool-call",toolCallId:eo.item.call_id,toolName:eo.item.name,input:eo.item.arguments,providerMetadata:{[l]:{itemId:eo.item.id}}});else if("web_search_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:eo.item.id,toolName:a.toCustomToolName(null!=i?i:"web_search"),result:tF(eo.item.action)});else if("computer_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-input-end",id:eo.item.id}),r.enqueue({type:"tool-call",toolCallId:eo.item.id,toolName:a.toCustomToolName("computer_use"),input:"",providerExecuted:!0}),r.enqueue({type:"tool-result",toolCallId:eo.item.id,toolName:a.toCustomToolName("computer_use"),result:{type:"computer_use_tool_result",status:eo.item.status||"completed"}});else if("file_search_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:eo.item.id,toolName:a.toCustomToolName("file_search"),result:{queries:eo.item.queries,results:null!=(b=null==(d=eo.item.results)?void 0:d.map(e=>({attributes:e.attributes,fileId:e.file_id,filename:e.filename,score:e.score,text:e.text})))?b:null}});else if("code_interpreter_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-result",toolCallId:eo.item.id,toolName:a.toCustomToolName("code_interpreter"),result:{outputs:eo.item.outputs}});else if("image_generation_call"===eo.item.type)r.enqueue({type:"tool-result",toolCallId:eo.item.id,toolName:a.toCustomToolName("image_generation"),result:{result:eo.item.result}});else if("mcp_call"===eo.item.type){y[eo.output_index]=void 0;let e=null!=(w=eo.item.approval_request_id)?w:void 0,t=null!=e&&null!=(k=null!=(x=m.get(e))?x:c[e])?k:eo.item.id,n=`mcp.${eo.item.name}`;r.enqueue({type:"tool-call",toolCallId:t,toolName:n,input:eo.item.arguments,providerExecuted:!0,dynamic:!0}),r.enqueue({type:"tool-result",toolCallId:t,toolName:n,result:{type:"call",serverLabel:eo.item.server_label,name:eo.item.name,arguments:eo.item.arguments,...null!=eo.item.output?{output:eo.item.output}:{},...null!=eo.item.error?{error:eo.item.error}:{}},providerMetadata:{[l]:{itemId:eo.item.id}}})}else if("mcp_list_tools"===eo.item.type)y[eo.output_index]=void 0;else if("apply_patch_call"===eo.item.type){let e=y[eo.output_index];(null==e?void 0:e.applyPatch)&&!e.applyPatch.endEmitted&&"delete_file"!==eo.item.operation.type&&(e.applyPatch.hasDiff||r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:tU(eo.item.operation.diff)}),r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}}'}),r.enqueue({type:"tool-input-end",id:e.toolCallId}),e.applyPatch.endEmitted=!0),e&&"completed"===eo.item.status&&r.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:a.toCustomToolName("apply_patch"),input:JSON.stringify({callId:eo.item.call_id,operation:eo.item.operation}),providerMetadata:{[l]:{itemId:eo.item.id}}}),y[eo.output_index]=void 0}else if("mcp_approval_request"===eo.item.type){y[eo.output_index]=void 0;let e=null!=(T=null==(I=(j=p.config).generateId)?void 0:I.call(j))?T:M(),t=null!=(P=eo.item.approval_request_id)?P:eo.item.id;m.set(t,e);let n=`mcp.${eo.item.name}`;r.enqueue({type:"tool-call",toolCallId:e,toolName:n,input:eo.item.arguments,providerExecuted:!0,dynamic:!0}),r.enqueue({type:"tool-approval-request",approvalId:t,toolCallId:e})}else if("local_shell_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-call",toolCallId:eo.item.call_id,toolName:a.toCustomToolName("local_shell"),input:JSON.stringify({action:{type:"exec",command:eo.item.action.command,timeoutMs:eo.item.action.timeout_ms,user:eo.item.action.user,workingDirectory:eo.item.action.working_directory,env:eo.item.action.env}}),providerMetadata:{[l]:{itemId:eo.item.id}}});else if("shell_call"===eo.item.type)y[eo.output_index]=void 0,r.enqueue({type:"tool-call",toolCallId:eo.item.call_id,toolName:a.toCustomToolName("shell"),input:JSON.stringify({action:{commands:eo.item.action.commands}}),providerMetadata:{[l]:{itemId:eo.item.id}}});else if("reasoning"===eo.item.type){for(let e of Object.entries(v[eo.item.id].summaryParts).filter(([e,t])=>"active"===t||"can-conclude"===t).map(([e])=>e))r.enqueue({type:"reasoning-end",id:`${eo.item.id}:${e}`,providerMetadata:{[l]:{itemId:eo.item.id,reasoningEncryptedContent:null!=(C=eo.item.encrypted_content)?C:null}}});delete v[eo.item.id]}}else if("response.function_call_arguments.delta"===eo.type){let e=y[eo.output_index];null!=e&&r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:eo.delta})}else if("response.apply_patch_call_operation_diff.delta"===eo.type){let e=y[eo.output_index];(null==e?void 0:e.applyPatch)&&(r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:tU(eo.delta)}),e.applyPatch.hasDiff=!0)}else if("response.apply_patch_call_operation_diff.done"===eo.type){let e=y[eo.output_index];(null==e?void 0:e.applyPatch)&&!e.applyPatch.endEmitted&&(e.applyPatch.hasDiff||(r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:tU(eo.diff)}),e.applyPatch.hasDiff=!0),r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}}'}),r.enqueue({type:"tool-input-end",id:e.toolCallId}),e.applyPatch.endEmitted=!0)}else if("response.image_generation_call.partial_image"===eo.type)r.enqueue({type:"tool-result",toolCallId:eo.item_id,toolName:a.toCustomToolName("image_generation"),result:{result:eo.partial_image_b64},preliminary:!0});else if("response.code_interpreter_call_code.delta"===eo.type){let e=y[eo.output_index];null!=e&&r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:tU(eo.delta)})}else if("response.code_interpreter_call_code.done"===eo.type){let e=y[eo.output_index];null!=e&&(r.enqueue({type:"tool-input-delta",id:e.toolCallId,delta:'"}'}),r.enqueue({type:"tool-input-end",id:e.toolCallId}),r.enqueue({type:"tool-call",toolCallId:e.toolCallId,toolName:a.toCustomToolName("code_interpreter"),input:JSON.stringify({code:eo.code,containerId:e.codeInterpreter.containerId}),providerExecuted:!0}))}else if("response.created"===eo.type)f=eo.response.id,r.enqueue({type:"response-metadata",id:eo.response.id,timestamp:new Date(1e3*eo.response.created_at),modelId:eo.response.model});else if("response.output_text.delta"===eo.type)r.enqueue({type:"text-delta",id:eo.item_id,delta:eo.delta}),(null==(S=null==(N=e.providerOptions)?void 0:N[l])?void 0:S.logprobs)&&eo.logprobs&&h.push(eo.logprobs);else if("response.reasoning_summary_part.added"===eo.type){if(eo.summary_index>0){let e=v[eo.item_id];for(let t of(e.summaryParts[eo.summary_index]="active",Object.keys(e.summaryParts)))"can-conclude"===e.summaryParts[t]&&(r.enqueue({type:"reasoning-end",id:`${eo.item_id}:${t}`,providerMetadata:{[l]:{itemId:eo.item_id}}}),e.summaryParts[t]="concluded");r.enqueue({type:"reasoning-start",id:`${eo.item_id}:${eo.summary_index}`,providerMetadata:{[l]:{itemId:eo.item_id,reasoningEncryptedContent:null!=(E=null==(A=v[eo.item_id])?void 0:A.encryptedContent)?E:null}}})}}else{"response.reasoning_summary_text.delta"===eo.type?r.enqueue({type:"reasoning-delta",id:`${eo.item_id}:${eo.summary_index}`,delta:eo.delta,providerMetadata:{[l]:{itemId:eo.item_id}}}):"response.reasoning_summary_part.done"===eo.type?s?(r.enqueue({type:"reasoning-end",id:`${eo.item_id}:${eo.summary_index}`,providerMetadata:{[l]:{itemId:eo.item_id}}}),v[eo.item_id].summaryParts[eo.summary_index]="concluded"):v[eo.item_id].summaryParts[eo.summary_index]="can-conclude":"response.completed"===(en=eo).type||"response.incomplete"===en.type?(g={unified:tA({finishReason:null==(q=eo.response.incomplete_details)?void 0:q.reason,hasFunctionCall:_}),raw:null!=($=null==(R=eo.response.incomplete_details)?void 0:R.reason)?$:void 0},n=eo.response.usage,"string"==typeof eo.response.service_tier&&(t=eo.response.service_tier)):"response.output_text.annotation.added"===eo.type?(z.push(eo.annotation),"url_citation"===eo.annotation.type?r.enqueue({type:"source",sourceType:"url",id:null!=(F=null==(Z=(O=p.config).generateId)?void 0:Z.call(O))?F:M(),url:eo.annotation.url,title:eo.annotation.title}):"file_citation"===eo.annotation.type?r.enqueue({type:"source",sourceType:"document",id:null!=(L=null==(K=(U=p.config).generateId)?void 0:K.call(U))?L:M(),mediaType:"text/plain",title:null!=(V=null!=(D=eo.annotation.quote)?D:eo.annotation.filename)?V:"Document",filename:null!=(H=eo.annotation.filename)?H:eo.annotation.file_id,...eo.annotation.file_id?{providerMetadata:{[l]:{fileId:eo.annotation.file_id}}}:{}}):"container_file_citation"===eo.annotation.type?r.enqueue({type:"source",sourceType:"document",id:null!=(G=null==(W=(B=p.config).generateId)?void 0:W.call(B))?G:M(),mediaType:"text/plain",title:null!=(Y=null!=(J=eo.annotation.filename)?J:eo.annotation.file_id)?Y:"Document",filename:null!=(X=eo.annotation.filename)?X:eo.annotation.file_id,providerMetadata:{[l]:{fileId:eo.annotation.file_id,containerId:eo.annotation.container_id,...null!=eo.annotation.index?{index:eo.annotation.index}:{}}}}):"file_path"===eo.annotation.type&&r.enqueue({type:"source",sourceType:"document",id:null!=(et=null==(ee=(Q=p.config).generateId)?void 0:ee.call(Q))?et:M(),mediaType:"application/octet-stream",title:eo.annotation.file_id,filename:eo.annotation.file_id,providerMetadata:{[l]:{fileId:eo.annotation.file_id,...null!=eo.annotation.index?{index:eo.annotation.index}:{}}}})):"error"===eo.type&&r.enqueue({type:"error",error:eo})}},flush(e){let o={[l]:{responseId:f}};h.length>0&&(o[l].logprobs=h),void 0!==t&&(o[l].serviceTier=t),e.enqueue({type:"finish",finishReason:g,usage:tP(n),providerMetadata:o})}})),request:{body:o},response:{headers:u}}}};function tZ(e){return"response.output_item.added"===e.type}function tF(e){var t;switch(e.type){case"search":return{action:{type:"search",query:null!=(t=e.query)?t:void 0},...null!=e.sources&&{sources:e.sources}};case"open_page":return{action:{type:"openPage",url:e.url}};case"find_in_page":return{action:{type:"findInPage",url:e.url,pattern:e.pattern}}}}function tU(e){return JSON.stringify(e).slice(1,-1)}var tK=ew(()=>ek(eM.z.object({instructions:eM.z.string().nullish(),speed:eM.z.number().min(.25).max(4).default(1).nullish()}))),tL=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:n="mp3",speed:o,instructions:r,language:i,providerOptions:a}){let s=[],l=await eN({provider:"openai",providerOptions:a,schema:tK}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:o,instructions:r};if(n&&(["mp3","opus","aac","flac","wav","pcm"].includes(n)?u.response_format=n:s.push({type:"unsupported",feature:"outputFormat",details:`Unsupported output format: ${n}. Using mp3 instead.`})),l){let e={};for(let t in e){let n=e[t];void 0!==n&&(u[t]=n)}}return i&&s.push({type:"unsupported",feature:"language",details:`OpenAI speech models do not support language selection. Language parameter "${i}" was ignored.`}),{requestBody:u,warnings:s}}async doGenerate(e){var t,n,o;let r=null!=(o=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?o:new Date,{requestBody:i,warnings:a}=await this.getArgs(e),{value:s,responseHeaders:l,rawValue:u}=await eA({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),body:i,failedResponseHandler:eF,successfulResponseHandler:async({response:e,url:t,requestBodyValues:n})=>{let o=P(e);if(!e.body)throw new w.APICallError({message:"Response body is empty",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:o,value:new Uint8Array(t)}}catch(r){throw new w.APICallError({message:"Failed to read response as array buffer",url:t,requestBodyValues:n,statusCode:e.status,responseHeaders:o,responseBody:void 0,cause:r})}},abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:s,warnings:a,request:{body:JSON.stringify(i)},response:{timestamp:r,modelId:this.modelId,headers:l,body:u}}}},tD=ew(()=>ek(eM.z.object({text:eM.z.string(),language:eM.z.string().nullish(),duration:eM.z.number().nullish(),words:eM.z.array(eM.z.object({word:eM.z.string(),start:eM.z.number(),end:eM.z.number()})).nullish(),segments:eM.z.array(eM.z.object({id:eM.z.number(),seek:eM.z.number(),start:eM.z.number(),end:eM.z.number(),text:eM.z.string(),tokens:eM.z.array(eM.z.number()),temperature:eM.z.number(),avg_logprob:eM.z.number(),compression_ratio:eM.z.number(),no_speech_prob:eM.z.number()})).nullish()}))),tV=ew(()=>ek(eM.z.object({include:eM.z.array(eM.z.string()).optional(),language:eM.z.string().optional(),prompt:eM.z.string().optional(),temperature:eM.z.number().min(0).max(1).default(0).optional(),timestampGranularities:eM.z.array(eM.z.enum(["word","segment"])).default(["segment"]).optional()}))),tH={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},tB=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:n}){let o=await eN({provider:"openai",providerOptions:n,schema:tV}),r=new FormData,i=e instanceof Uint8Array?new Blob([e]):new Blob([S(e)]);r.append("model",this.modelId);let a=function(e){var t;let[n,o=""]=e.toLowerCase().split("/");return null!=(t=({mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"})[o])?t:o}(t);if(r.append("file",new File([i],"audio",{type:t}),`audio.${a}`),o){for(let[e,t]of Object.entries({include:o.include,language:o.language,prompt:o.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:o.temperature,timestamp_granularities:o.timestampGranularities}))if(null!=t)if(Array.isArray(t))for(let n of t)r.append(`${e}[]`,String(n));else r.append(e,String(t))}return{formData:r,warnings:[]}}async doGenerate(e){var t,n,o,r,i,a,s,l;let u=null!=(o=null==(n=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:n.call(t))?o:new Date,{formData:d,warnings:p}=await this.getArgs(e),{value:c,responseHeaders:m,rawValue:g}=await eE({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:T(this.config.headers(),e.headers),formData:d,failedResponseHandler:eF,successfulResponseHandler:eO(tD),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=null!=c.language&&c.language in tH?tH[c.language]:void 0;return{text:c.text,segments:null!=(s=null!=(a=null==(r=c.segments)?void 0:r.map(e=>({text:e.text,startSecond:e.start,endSecond:e.end})))?a:null==(i=c.words)?void 0:i.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?s:[],language:h,durationInSeconds:null!=(l=c.duration)?l:void 0,warnings:p,response:{timestamp:u,modelId:this.modelId,headers:m,body:g}}}},tW=function(e={}){var t,n,o;let r=null!=(t=null==(o=function({settingValue:e,environmentVariableName:t}){return"string"==typeof e?e:null!=e||"undefined"==typeof process?void 0:null!=(e=process.env[t])&&"string"==typeof e?e:void 0}({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"}))?void 0:o.replace(/\/$/,""))?t:"https://api.openai.com/v1",i=null!=(n=e.name)?n:"openai",a=()=>U({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:n="apiKey",description:o}){if("string"==typeof e)return e;if(null!=e)throw new w.LoadAPIKeyError({message:`${o} API key must be a string.`});if("undefined"==typeof process)throw new w.LoadAPIKeyError({message:`${o} API key is missing. Pass it using the '${n}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new w.LoadAPIKeyError({message:`${o} API key is missing. Pass it using the '${n}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new w.LoadAPIKeyError({message:`${o} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},"ai-sdk/openai/3.0.4"),s=t=>new e9(t,{provider:`${i}.embedding`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),l=t=>new e7(t,{provider:`${i}.image`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),u=t=>new tB(t,{provider:`${i}.transcription`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),d=t=>new tL(t,{provider:`${i}.speech`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),p=e=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return c(e)},c=t=>new tM(t,{provider:`${i}.responses`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch,fileIdPrefixes:["file-"]}),m=function(e){return p(e)};return m.specificationVersion="v3",m.languageModel=p,m.chat=t=>new eW(t,{provider:`${i}.chat`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),m.completion=t=>new e1(t,{provider:`${i}.completion`,url:({path:e})=>`${r}${e}`,headers:a,fetch:e.fetch}),m.responses=c,m.embedding=s,m.embeddingModel=s,m.textEmbedding=s,m.textEmbeddingModel=s,m.image=l,m.imageModel=l,m.transcription=u,m.transcriptionModel=u,m.speech=d,m.speechModel=d,m.tools=tT,m}(),tG=e.i(12075);let tJ={marketing:{id:"agent-1-marketing",name:"TowGuard24 Hybrid Marketing Intelligence",description:"Agent #1 of the TowGuard24 AI Workforce: a hybrid CMO + Strategist + Creative Director focused on growth, storytelling, and persuasive communication.",model:"gpt-4o",temperature:.7,maxTokens:2e3,systemPrompt:`
You are Agent #1 of the TowGuard24 AI Workforce: the Hybrid Marketing Intelligence.
Your role is a fusion of Chief Marketing Officer, Senior Marketing Strategist, and Creative Director.
Your mission is to grow TowGuard24 through persuasive communication, storytelling, and high-impact marketing across all channels.

You think like a human marketer who has spent years studying persuasion, branding, and human behavior.
You understand roadside assistance customers, drivers, fleets, families, and partners.
You always write in clear, modern, human language.

Core responsibilities:

- Understand TowGuard24's customers, their fears, desires, and hidden motivations.

- Turn TowGuard24's features into compelling benefits and stories.

- Create social content, ads, emails, SMS campaigns, landing pages, scripts, funnels, and brand messaging.

- Protect and evolve the TowGuard24 brand voice across all channels.

- Use storytelling and psychology to move people to action without manipulation.

TowGuard24 key positioning:

- Fast, safe, and reliable roadside assistance.

- Roadside help in minutes, not hours.

- 24/7 coverage in expanding states.

- Trusted by drivers, fleets, and families.

- One tap and help is on the way.

Automatic tone switching:
You automatically choose the best tone based on the task and context:

- Use bold, high-energy tone for viral hooks, TikTok/Reels scripts, and attention-grabbing social posts.

- Use professional, trust-focused tone for partnerships, fleet outreach, website copy, and serious B2B communication.

- Use friendly, human tone for customer emails, SMS, community content, and empathetic updates.

- Use aggressive growth-hacker tone for paid ads, funnels, lead magnets, and direct-response campaigns.
The user does not need to specify the tone. You infer it from the task.

Persuasion and psychology:
You write as if you have deeply absorbed the principles from classic marketing and persuasion books (such as Influence, Made to Stick, Building a StoryBrand, Contagious, Ogilvy on Advertising, Breakthrough Advertising, Cashvertising, and The Copywriter's Handbook). You do not quote these books; instead, you apply their principles in your work.

You actively use:

- Social proof, authority, reciprocity, and urgency (ethically).

- Identity-based messaging: speak to who the customer sees themselves as.

- Clear problem  agitation  solution structure when appropriate.

- Benefit-driven and transformation-focused language, not just features.Concrete, vivid details and simple, sticky ideas.

Storytelling engine:

- Turn features into stories with characters, conflict, and resolution.

- Create "before and after" transformations.

- Write customer journeys that show how TowGuard24 changes their day.

- Use narrative arcs that are emotionally engaging but still concise.

- Make TowGuard24 feel like a movement, not just a service.

Brand voice rules:

- Clear, confident, modern, and grounded.

- Safety-first, reliability-first, speed-focused.

- Never use fear-mongering or manipulative guilt.

- Avoid corporate jargon and robotic phrasing.

- Prefer short, strong sentences and sharp hooks.
Output expectations:

- Always think strategically for a moment before writing.

- When asked for content, you may propose structure or variations if helpful.

- When helpful, briefly explain why a particular angle or hook was chosen.

- All content must be ready to copy-paste and use.

Rules:

- Always choose the best tone automatically; do not ask the user which tone to use.

- Always align with TowGuard24's mission: fast, safe, reliable roadside assistance.

- Always optimize for clarity, persuasion, and emotional connection.

- Always sound like a skilled human marketer who understands real people.
  `.trim()},support:{id:"agent-2-support",name:"TowGuard24 Customer Support Agent",description:"Agent #2 of the TowGuard24 AI Workforce: a calm, safety-first support specialist that helps users during stressful roadside situations.",systemPrompt:`
You are TowGuard24s Customer Support Agent.

Your mission is to keep every driver safe, calm, and informed during stressful roadside situations.
You respond with clarity, empathy, and confidence. You never panic, never overwhelm, and never use technical jargon.

Your responsibilities:
- Help users understand how TowGuard24 works.
- Guide them through requesting help.
- Explain ETAs, pricing, and service types in simple terms.
- Provide reassurance during emergencies.
- Offer general safety instructions when someone is stranded.
- Keep responses short, clear, and human.
- Always prioritize the users safety and emotional state.

Tone:
- Warm, calm, steady.
- Professional but human.
- No emojis.
- No slang.
- No robotic phrasing.

Rules:
- Never give legal or medical advice.
- Never provide specific medical, legal, or financial instructions.
- Never guess exact tow truck arrival timesuse clear language like "typically", "usually", or "in many cases".
- Always remind users to stay safe and visible if stranded at night or on a highway.
- If a user expresses fear or stress, acknowledge it and guide them gently with calm, reassuring language.
- Do not replace professional emergency servicesif a situation sounds dangerous, remind users they may need to contact local emergency services.

Your goal is to make every user feel protected, understood, and supported while helping them use TowGuard24 effectively.
  `.trim()},sales:{id:"agent-3-sales",name:"TowGuard24 Sales & Conversion Agent",description:"Agent #3 of the TowGuard24 AI Workforce: a persuasive, strategic sales closer focused on converting leads, fleets, and partnerships into paying customers.",systemPrompt:`
You are TowGuard24s Sales & Conversion Agent.

Your mission is to turn interest into action. You convert leads, fleets, businesses, and everyday drivers into paying TowGuard24 customers using clear, persuasive, human communication.

You think like a top-performing sales rep who understands:
- roadside assistance customers
- fleet managers
- small business owners
- families and everyday drivers
- people in stressful situations who need clarity and confidence

Core responsibilities:
- Convert inbound leads from website, app, SMS, or Instagram.
- Write persuasive outreach messages for fleets, dealerships, and partners.
- Handle objections with calm confidence.
- Explain TowGuard24s value in simple, compelling language.
- Create scripts for calls, SMS, email, and DMs.
- Guide users toward signing up, activating protection, or requesting service.
- Identify the customers real motivation and speak directly to it.
- Always stay ethical, human, and helpful.

Sales psychology:
- Focus on benefits, not features.
- Use transformation language: before  after.
- Use social proof, authority, and clarity (never manipulation).
- Keep messages short, sharp, and easy to act on.
- Remove friction and make the next step obvious.

Tone:
- Confident, warm, and human.
- Never pushy or aggressive.
- Clear, modern, and persuasive.
- Always respectful and customer-first.

Rules:
- Never make false promises.
- Never pressure customers emotionally.
- Never give legal, medical, or financial advice.
- Never guarantee exact tow arrival times.
- Always align with TowGuard24s mission: fast, safe, reliable roadside assistance.

Your goal is to close deals, convert leads, and grow TowGuard24s customer base through ethical, high-impact communication.
  `.trim()}};async function tY(e,t){if(!process.env.OPENAI_API_KEY)throw Error("Missing OPENAI_API_KEY environment variable");let n=tJ[t];if(!n)throw Error(`Agent "${t}" not found`);let{text:o}=await (0,tG.generateText)({model:tW("gpt-4o-mini"),system:n.systemPrompt,prompt:e});return o}async function tX(e){try{let{agentId:t,message:n,history:o}=await e.json();if(!t||"string"!=typeof t)return b.NextResponse.json({error:"Missing or invalid 'agentId'."},{status:400});if(!n||"string"!=typeof n)return b.NextResponse.json({error:"Missing or invalid 'message'."},{status:400});let r=Object.values(tJ).find(e=>e.id===t);if(!r)return b.NextResponse.json({error:`Unknown agentId: ${t}`},{status:400});let i=[{role:"system",content:r.systemPrompt},...Array.isArray(o)?o:[],{role:"user",content:n}],a=await tY(i);return b.NextResponse.json({agentId:t,reply:a.content})}catch(e){return console.error("Agent API error:",e),b.NextResponse.json({error:"Agent API failed."},{status:500})}}e.s(["POST",()=>tX],44242);var tQ=e.i(44242);let t0=new o.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/agent/route",pathname:"/api/agent",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/agent/route.ts",nextConfigOutput:"",userland:tQ}),{workAsyncStorage:t1,workUnitAsyncStorage:t4,serverHooks:t2}=t0;function t9(){return(0,i.patchFetch)({workAsyncStorage:t1,workUnitAsyncStorage:t4})}async function t5(e,t,n){t0.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let o="/api/agent/route";o=o.replace(/\/index$/,"")||"/";let i=await t0.prepare(e,t,{srcPage:o,multiZoneDraftMode:!1});if(!i)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:b,params:w,nextConfig:x,parsedUrl:k,isDraftMode:j,prerenderManifest:I,routerServerContext:T,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,resolvedPathname:N,clientReferenceManifest:S,serverActionsManifest:A}=i,E=(0,d.normalizeAppPath)(o),q=!!(I.dynamicRoutes[E]||I.routes[N]),R=async()=>((null==T?void 0:T.render404)?await T.render404(e,t,k,!1):t.end("This page could not be found"),null);if(q&&!j){let e=!!I.routes[N],t=I.dynamicRoutes[E];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await R();throw new _.NoFallbackError}}let $=null;!q||t0.isDev||j||($="/index"===($=N)?"/":$);let O=!0===t0.isDev||!q,M=q&&!O;A&&S&&(0,l.setReferenceManifestsSingleton)({page:o,clientReferenceManifest:S,serverActionsManifest:A,serverModuleMap:(0,u.createServerModuleMap)({serverActionsManifest:A})});let Z=e.method||"GET",F=(0,s.getTracer)(),U=F.getActiveScopeSpan(),K={params:w,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:O,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,o)=>t0.onRequestError(e,t,o,T)},sharedContext:{buildId:b}},L=new p.NodeNextRequest(e),D=new p.NodeNextResponse(t),V=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let i=async e=>t0.handle(V,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=F.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${Z} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${Z} ${o}`)}),l=!!(0,a.getRequestMeta)(e,"minimalMode"),u=async a=>{var s,u;let d=async({previousCacheEntry:r})=>{try{if(!l&&P&&C&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(a);e.fetchMetrics=K.renderOpts.fetchMetrics;let s=K.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let u=K.renderOpts.collectedTags;if(!q)return await (0,h.sendResponse)(L,D,o,K.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[z.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=z.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,r=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=z.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==r?void 0:r.isStale)&&await t0.onRequestError(e,t,{routerKind:"App Router",routePath:o,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})},T),t}},p=await t0.handleResponse({req:e,nextConfig:x,cacheKey:$,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:C,responseGenerator:d,waitUntil:n.waitUntil,isMinimalMode:l});if(!q)return null;if((null==p||null==(s=p.value)?void 0:s.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(u=p.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",P?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),j&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,f.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&q||c.delete(z.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,y.getCacheControlHeader)(p.cacheControl)),await (0,h.sendResponse)(L,D,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};U?await u(U):await F.withPropagatedContext(e.headers,()=>F.trace(m.BaseServerSpan.handleRequest,{spanName:`${Z} ${o}`,kind:s.SpanKind.SERVER,attributes:{"http.method":Z,"http.target":e.url}},u))}catch(t){if(t instanceof _.NoFallbackError||await t0.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,g.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:P})}),q)throw t;return await (0,h.sendResponse)(L,D,new Response(null,{status:500})),null}}e.s(["handler",()=>t5,"patchFetch",()=>t9,"routeModule",()=>t0,"serverHooks",()=>t2,"workAsyncStorage",()=>t1,"workUnitAsyncStorage",()=>t4],57522)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_2ca890f0.js.map